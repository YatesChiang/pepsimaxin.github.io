<!DOCTYPE HTML>
<html lang="zh-CN">


<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <meta name="keywords" content="Ê∑±ÂÖ•ÈíªÁ†î Android ÂêØÂä®Èò∂ÊÆµ ‰πã zygote, Thinking in Android">
    <meta name="description" content="
üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄAndroid ÂêØÂä®Èò∂ÊÆµÁ≥ªÂàóüçÄ üçÄ üçÄ üçÄ üçÄ üçÄ ÔøΩ">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Ê∑±ÂÖ•ÈíªÁ†î Android ÂêØÂä®Èò∂ÊÆµ ‰πã zygote | Thinking in Android</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    <style type="text/css">
        
    </style>

    <script src="/libs/jquery/jquery-2.2.0.min.js"></script>
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>

<header class="navbar-fixed">
    <nav id="headNav" class="bg-color-header-marco nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <!--<div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Thinking in Android</span>
                </a>
            </div>-->
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/" class="waves-effect waves-light">
            
            <i class="fa fa-home"></i>
            
            <span>È¶ñÈ°µ</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories" class="waves-effect waves-light">
            
            <i class="fa fa-bookmark"></i>
            
            <span>ÁõÆÂΩï</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/tags" class="waves-effect waves-light">
            
            <i class="fa fa-tags"></i>
            
            <span>Ê†áÁ≠æ</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories/ÂõõÂ§ßÁªÑ‰ª∂/" class="waves-effect waves-light">
            
            <i class="fa fa-cube"></i>
            
            <span>ÁªÑ‰ª∂</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories/Á≥ªÁªüÂêØÂä®/" class="waves-effect waves-light">
            
            <i class="fa fa-spinner"></i>
            
            <span>ÂºÄÊú∫</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories/Ê°ÜÊû∂ÊúçÂä°/" class="waves-effect waves-light">
            
            <i class="fa fa-superpowers"></i>
            
            <span>Ê°ÜÊû∂</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories/Ê†∏ÂøÉÊú∫Âà∂/" class="waves-effect waves-light">
            
            <i class="fa fa-link"></i>
            
            <span>Êú∫Âà∂</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories/ÊÄßËÉΩ‰ºòÂåñ/" class="waves-effect waves-light">
            
            <i class="fa fa-yelp"></i>
            
            <span>‰ºòÂåñ</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories/ËÆæËÆ°Ê®°Âºè/" class="waves-effect waves-light">
            
            <i class="fa fa-envira"></i>
            
            <span>Ê®°Âºè</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories/ÁÆóÊ≥ï‰∏ìÊ†è/" class="waves-effect waves-light">
            
            <i class="fa fa-modx"></i>
            
            <span>ÁÆóÊ≥ï</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories/ÊäÄÊúØÂÇ®Â§á/" class="waves-effect waves-light">
            
            <i class="fa fa-linode"></i>
            
            <span>ÊãìÂ±ï</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/about" class="waves-effect waves-light">
            
            <i class="fa fa-user-circle-o"></i>
            
            <span>‰ΩúËÄÖ</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories/ÊäÄÊúØÁªÜËäÇ/" class="waves-effect waves-light">
            
            <i class="fa fa-file-text"></i>
            
            <span>FAQ</span>
        </a>
    </li>
    
    <li>
        <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fa fa-search" title="Ê£ÄÁ¥¢ÂçöÊñá"></i>
        </a>
    </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Thinking in Android</div>
        <div class="logo-desc">
            
            Victory belongs to the most persevering.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-home"></i>
                
                È¶ñÈ°µ
            </a>
        </li>
        
        <li>
            <a href="/categories" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-bookmark"></i>
                
                ÁõÆÂΩï
            </a>
        </li>
        
        <li>
            <a href="/tags" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-tags"></i>
                
                Ê†áÁ≠æ
            </a>
        </li>
        
        <li>
            <a href="/categories/ÂõõÂ§ßÁªÑ‰ª∂/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-cube"></i>
                
                ÁªÑ‰ª∂
            </a>
        </li>
        
        <li>
            <a href="/categories/Á≥ªÁªüÂêØÂä®/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-spinner"></i>
                
                ÂºÄÊú∫
            </a>
        </li>
        
        <li>
            <a href="/categories/Ê°ÜÊû∂ÊúçÂä°/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-superpowers"></i>
                
                Ê°ÜÊû∂
            </a>
        </li>
        
        <li>
            <a href="/categories/Ê†∏ÂøÉÊú∫Âà∂/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-link"></i>
                
                Êú∫Âà∂
            </a>
        </li>
        
        <li>
            <a href="/categories/ÊÄßËÉΩ‰ºòÂåñ/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-yelp"></i>
                
                ‰ºòÂåñ
            </a>
        </li>
        
        <li>
            <a href="/categories/ËÆæËÆ°Ê®°Âºè/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-envira"></i>
                
                Ê®°Âºè
            </a>
        </li>
        
        <li>
            <a href="/categories/ÁÆóÊ≥ï‰∏ìÊ†è/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-modx"></i>
                
                ÁÆóÊ≥ï
            </a>
        </li>
        
        <li>
            <a href="/categories/ÊäÄÊúØÂÇ®Â§á/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-linode"></i>
                
                ÊãìÂ±ï
            </a>
        </li>
        
        <li>
            <a href="/about" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-user-circle-o"></i>
                
                ‰ΩúËÄÖ
            </a>
        </li>
        
        <li>
            <a href="/categories/ÊäÄÊúØÁªÜËäÇ/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-file-text"></i>
                
                FAQ
            </a>
        </li>
        
        
    </ul>
</div>

        </div>

        
    </nav>

</header>





<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/Á≥ªÁªüÂêØÂä®-02.jpg')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        Ê∑±ÂÖ•ÈíªÁ†î Android ÂêØÂä®Èò∂ÊÆµ ‰πã zygote
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="container content">

    
    <!-- ÊñáÁ´†ÂÜÖÂÆπËØ¶ÊÉÖ -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/ÂêØÂä®Èò∂ÊÆµ/" target="_blank">
                                <span class="chip bg-color">ÂêØÂä®Èò∂ÊÆµ</span>
                            </a>
                        
                            <a href="/tags/zygote/" target="_blank">
                                <span class="chip bg-color">zygote</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fa fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Á≥ªÁªüÂêØÂä®/" class="post-category" target="_blank">
                                Á≥ªÁªüÂêØÂä®
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                <div class="post-date info-break-policy">
                    <i class="fa fa-calendar-minus-o fa-fw"></i>&nbsp;ÂèëÂ∏ÉÊó•Êúü :&nbsp;
                    2018-12-10
                </div>

                
                    
                    <div class="info-break-policy">
                        <i class="fa fa-file-word-o fa-fw"></i>&nbsp;ÊñáÁ´†Â≠óÊï∞ :&nbsp;
                        2.2k
                    </div>
                    

                    
                    <div class="info-break-policy">
                        <i class="fa fa-clock-o fa-fw"></i>&nbsp;ÈòÖËØªÊó∂Èïø :&nbsp;
                        10 ÂàÜÈíü
                    </div>
                    
                
				
				
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="fa fa-eye fa-fw"></i>&nbsp;ÈòÖËØªÊ¨°Êï∞ :&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
		<br>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <p><br></p>
<center>üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ</center><br><center><strong><font color="#1874CD"><font color="#3A5FCD" size="4">Android ÂêØÂä®Èò∂ÊÆµÁ≥ªÂàó</font></font></strong></center><br><center>üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ</center>

<p><br></p>
<table>
<thead>
<tr>
<th style="text-align:center"><strong><font color="#EE2C2C" size="3">„ÄêÂêØÂä®Èò∂ÊÆµ„Äë</font></strong></th>
<th style="text-align:center"><strong><font color="#0000FF" size="3">„ÄêÁõ∏ÂÖ≥ÊñáÁ´†„Äë</font></strong></th>
<th style="text-align:center"><strong><font color="#9932CC" size="3">Ê∫êÁ†ÅÁâàÊú¨</font></strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong><font color="#FF7F00" size="3">init</font></strong></td>
<td style="text-align:center"><a href="https://superandroid.pro/2018/12/01/%E3%80%90%E5%90%AF%E5%8A%A8%E9%98%B6%E6%AE%B5%E3%80%91Android%20%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8%E7%AF%87%20--%20%E6%B7%B1%E5%85%A5%E9%92%BB%E7%A0%94%20Android%20%E5%90%AF%E5%8A%A8%E9%98%B6%E6%AE%B5%20%E4%B9%8B%20init/">Ê∑±ÂÖ•ÈíªÁ†î Android ÂêØÂä®Èò∂ÊÆµ ‰πã init</a></td>
<td style="text-align:center"><font color="#FF0000" size="3">Android 9.0</font></td>
</tr>
<tr>
<td style="text-align:center"><strong><font color="#FF7F00" size="3">zygote</font></strong></td>
<td style="text-align:center"><a href="https://superandroid.pro/2018/12/10/%E3%80%90%E5%90%AF%E5%8A%A8%E9%98%B6%E6%AE%B5%E3%80%91Android%20%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8%E7%AF%87%20--%20%E6%B7%B1%E5%85%A5%E9%92%BB%E7%A0%94%20Android%20%E5%90%AF%E5%8A%A8%E9%98%B6%E6%AE%B5%20%E4%B9%8B%20zygote/">Ê∑±ÂÖ•ÈíªÁ†î Android ÂêØÂä®Èò∂ÊÆµ ‰πã zygote</a></td>
<td style="text-align:center"><font color="#FF0000" size="3">Android 9.0</font></td>
</tr>
<tr>
<td style="text-align:center"><strong><font color="#FF7F00" size="3">systemserver</font></strong></td>
<td style="text-align:center"><a href="https://superandroid.pro/2018/12/18/%E3%80%90%E5%90%AF%E5%8A%A8%E9%98%B6%E6%AE%B5%E3%80%91Android%20%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8%E7%AF%87%20--%20%E6%B7%B1%E5%85%A5%E9%92%BB%E7%A0%94%20Android%20%E5%90%AF%E5%8A%A8%E9%98%B6%E6%AE%B5%20%E4%B9%8B%20systemserver/">Ê∑±ÂÖ•ÈíªÁ†î Android ÂêØÂä®Èò∂ÊÆµ ‰πã systemserver</a></td>
<td style="text-align:center"><font color="#FF0000" size="3">Android 9.0</font></td>
</tr>
<tr>
<td style="text-align:center"><strong><font color="#FF7F00" size="3">Launcher</font></strong></td>
<td style="text-align:center"><a href="https://superandroid.pro/2018/12/26/%E3%80%90%E5%90%AF%E5%8A%A8%E9%98%B6%E6%AE%B5%E3%80%91Android%20%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8%E7%AF%87%20--%20%E6%B7%B1%E5%85%A5%E9%92%BB%E7%A0%94%20Android%20%E5%90%AF%E5%8A%A8%E9%98%B6%E6%AE%B5%20%E4%B9%8B%20Launcher/">Ê∑±ÂÖ•ÈíªÁ†î Android ÂêØÂä®Èò∂ÊÆµ ‰πã Launcher ÂêØÂä®ÂèäÂä†ËΩΩÊµÅÁ®ã</a></td>
<td style="text-align:center"><font color="#FF0000" size="3">Android 9.0</font></td>
</tr>
</tbody>
</table>
<p><br></p>
<p><strong><font color="#3A5FCD" size="4">ÂçöÊñá‰øÆÊîπÊó•Âøó</font></strong><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8E388E">1„ÄÅÈáçÊñ∞Ê¢≥ÁêÜ zygote Ê∫êÁ†ÅÔºàAndroid 9.0ÔºâÔºõ</font><br><br></p>
<hr>
<h1 id="ÂºÄÁØá"><a href="#ÂºÄÁØá" class="headerlink" title="ÂºÄÁØá"></a>ÂºÄÁØá</h1><h2 id="Ê†∏ÂøÉÊ∫êÁ†Å"><a href="#Ê†∏ÂøÉÊ∫êÁ†Å" class="headerlink" title="Ê†∏ÂøÉÊ∫êÁ†Å"></a>Ê†∏ÂøÉÊ∫êÁ†Å</h2><table>
<thead>
<tr>
<th>ÂÖ≥ÈîÆÁ±ª</th>
<th>Ë∑ØÂæÑ</th>
</tr>
</thead>
<tbody>
<tr>
<td><font color="#D15FEE">init.rc</font></td>
<td>system/core/rootdir/init.rc</td>
</tr>
<tr>
<td><font color="#D15FEE">init.cpp</font></td>
<td>system/core/init/init.cpp</td>
</tr>
<tr>
<td><font color="#D15FEE">init.zygote64.rc</font></td>
<td>system/core/rootdir/init.zygote64.rc</td>
</tr>
<tr>
<td><font color="#D15FEE">builtins.cpp</font></td>
<td>system/core/init/builtins.cpp</td>
</tr>
<tr>
<td><font color="#D15FEE">service.cpp</font></td>
<td>system/core/init/service.cpp</td>
</tr>
<tr>
<td><font color="#D15FEE">app_main.cpp</font></td>
<td>frameworks/base/cmds/app_process/app_main.cpp</td>
</tr>
<tr>
<td><font color="#D15FEE">AndroidRuntime.cpp</font></td>
<td>frameworks/base/core/jni/AndroidRuntime.cpp</td>
</tr>
<tr>
<td><font color="#D15FEE">JniInvocation.cpp</font></td>
<td>libnativehelper/JniInvocation.cpp</td>
</tr>
<tr>
<td><font color="#D15FEE">ZygoteInit.java</font></td>
<td>frameworks/base/core/java/com/android/internal/os/ZygoteInit.java</td>
</tr>
<tr>
<td><font color="#D15FEE">ZygoteServer.java</font></td>
<td>frameworks/base/core/java/com/android/internal/os/ZygoteServer.java</td>
</tr>
</tbody>
</table>
<h2 id="ZygoteÁÆÄ‰ªã"><a href="#ZygoteÁÆÄ‰ªã" class="headerlink" title="ZygoteÁÆÄ‰ªã"></a>ZygoteÁÆÄ‰ªã</h2><p>Âú®AndroidÁ≥ªÁªü‰∏≠ÔºåJavaVM(JavaËôöÊãüÊú∫)„ÄÅÂ∫îÁî®Á®ãÂ∫èËøõÁ®ã‰ª•ÂèäËøêË°åÁ≥ªÁªüÁöÑÂÖ≥ÈîÆÊúçÂä°ÁöÑSystemServerËøõÁ®ãÈÉΩÊòØÁî±ZygoteËøõÁ®ãÊù•ÂàõÂª∫ÁöÑÔºåÊàë‰ª¨‰πüÂ∞ÜÂÆÉÁß∞‰∏∫Â≠µÂåñÂô®„ÄÇÂÆÉÈÄöËøáfock(Â§çÂà∂ËøõÁ®ã)ÁöÑÂΩ¢ÂºèÊù•ÂàõÂª∫Â∫îÁî®Á®ãÂ∫èËøõÁ®ãÂíåSystemServerËøõÁ®ãÔºåÁî±‰∫éZygoteËøõÁ®ãÂú®ÂêØÂä®Êó∂‰ºöÂàõÂª∫JavaVMÔºåÂõ†Ê≠§ÈÄöËøáfockËÄåÂàõÂª∫ÁöÑÂ∫îÁî®Á®ãÂ∫èËøõÁ®ãÂíåSystemServerËøõÁ®ãÂèØ‰ª•Âú®ÂÜÖÈÉ®Ëé∑Âèñ‰∏Ä‰∏™JavaVMÁöÑÂÆû‰æãÊã∑Ë¥ù„ÄÇ</p>
<h1 id="Read-The-Fucking-Code"><a href="#Read-The-Fucking-Code" class="headerlink" title="Read The Fucking Code"></a>Read The Fucking Code</h1><h2 id="ZygoteËß¶Âèë"><a href="#ZygoteËß¶Âèë" class="headerlink" title="ZygoteËß¶Âèë"></a>ZygoteËß¶Âèë</h2><p>Âú®ÂàÜÊûêinitËøõÁ®ãÊó∂ÔºåÊàë‰ª¨Áü•ÈÅìinitËøõÁ®ãÂêØÂä®ÂêéÔºå‰ºöËß£Êûêinit.rcÊñá‰ª∂ÔºåÁÑ∂ÂêéÂàõÂª∫ÂíåÂä†ËΩΩserviceÂ≠óÊÆµÊåáÂÆöÁöÑËøõÁ®ã„ÄÇzygoteËøõÁ®ãÂ∞±ÊòØ‰ª•ËøôÁßçÊñπÂºèÔºåË¢´initËøõÁ®ãÂä†ËΩΩÁöÑ„ÄÇ</p>
<p>Âú®system/core/rootdir/init.rcÁöÑÂºÄÂßãÈÉ®ÂàÜÔºåÂèØ‰ª•ÁúãÂà∞Ôºö</p>
<pre><code>import /init.environ.rc
import /init.usb.rc
import /init.${ro.hardware}.rc
import /vendor/etc/init/hw/init.${ro.hardware}.rc
import /init.usb.configfs.rc
import /init.${ro.zygote}.rc           // ${ro.zygote}Áî±ÂéÇÂïÜÂÆö‰πâÔºå‰∏éÂπ≥Âè∞Áõ∏ÂÖ≥

on early-init
    # Set init and its forked children&#39;s oom_adj.
    write /proc/1/oom_score_adj -1000
</code></pre><h3 id="init-zygoteXX-rc"><a href="#init-zygoteXX-rc" class="headerlink" title="init.zygoteXX.rc"></a>init.zygoteXX.rc</h3><p>‰ªé‰πãÂâçÂàÜÊûêÁöÑinitÁØá‰∏≠Êàë‰ª¨Áü•ÈÅìÔºåÂú®‰∏çÂêåÁöÑÂπ≥Âè∞Ôºà32„ÄÅ64Âèä64_32Ôºâ‰∏äÔºåinit.rcÂ∞ÜÂåÖÂê´‰∏çÂêåÁöÑzygote.rcÊñá‰ª∂„ÄÇÂú®system/core/rootdirÁõÆÂΩï‰∏ãÔºåÊúâinit.zygote32_64.rc„ÄÅinit.zyote64.rc„ÄÅ init.zyote32.rc„ÄÅinit.zygote64_32.rc„ÄÇ </p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;‚ú® <font color="#87CEFA">init.zygote32.rc</font>Ôºözygote ËøõÁ®ãÂØπÂ∫îÁöÑÊâßË°åÁ®ãÂ∫èÊòØ app_process (Á∫Ø 32bit Ê®°Âºè)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;‚ú® <font color="#87CEFA">init.zygote64.rc</font>Ôºözygote ËøõÁ®ãÂØπÂ∫îÁöÑÊâßË°åÁ®ãÂ∫èÊòØ app_process64 (Á∫Ø 64bit Ê®°Âºè)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;‚ú® <font color="#87CEFA">init.zygote32_64.rc</font>ÔºöÂêØÂä®‰∏§‰∏™ zygote ËøõÁ®ã (Âêç‰∏∫ zygote Âíå zygote_secondary)ÔºåÂØπÂ∫îÁöÑÊâßË°åÁ®ãÂ∫èÂàÜÂà´ÊòØ app_process32 (‰∏ªÊ®°Âºè)„ÄÅapp_process64<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;‚ú® <font color="#87CEFA">init.zygote64_32.rc</font>ÔºöÂêØÂä®‰∏§‰∏™ zygote ËøõÁ®ã (Âêç‰∏∫ zygote Âíå zygote_secondary)ÔºåÂØπÂ∫îÁöÑÊâßË°åÁ®ãÂ∫èÂàÜÂà´ÊòØ app_process64 (‰∏ªÊ®°Âºè)„ÄÅapp_process32</p>
<p>‰∏∫‰ªÄ‰πàË¶ÅÂÆö‰πâËøô‰πàÂ§öÁßçÊÉÖÂÜµÂë¢ÔºüÁõ¥Êé•ÂÆö‰πâ‰∏Ä‰∏™‰∏çÂ∞±Â•Ω‰∫ÜÔºåËøô‰∏ªË¶ÅÊòØÂõ†‰∏∫Android 5.0‰ª•ÂêéÂºÄÂßãÊîØÊåÅ64‰ΩçÁ®ãÂ∫èÔºå‰∏∫‰∫ÜÂÖºÂÆπ32‰ΩçÂíå64‰ΩçÊâçËøôÊ†∑ÂÆö‰πâ„ÄÇ‰∏çÂêåÁöÑzygote.rcÂÜÖÂÆπÂ§ßËá¥Áõ∏ÂêåÔºå‰∏ªË¶ÅÂå∫Âà´‰ΩìÁé∞Âú®ÂêØÂä®ÁöÑÊòØ32‰ΩçÔºåËøòÊòØ64‰ΩçÁöÑËøõÁ®ã„ÄÇinit.zygote32_64.rcÂíåinit.zygote64_32.rc‰ºöÂêØÂä®‰∏§‰∏™ËøõÁ®ãÔºå‰∏îÂ≠òÂú®‰∏ªÊ¨°‰πãÂàÜ„ÄÇ</p>
<p>ËøôÈáåÊãø64‰ΩçÂ§ÑÁêÜÂô®‰∏∫‰æãÔºåinit.zygote64_32.rcÁöÑ‰ª£Á†ÅÂ¶Ç‰∏ãÊâÄÁ§∫Ôºö</p>
<pre><code>// ËøõÁ®ãÂêçÁß∞ÊòØzygote,ËøêË°åÁöÑ‰∫åËøõÂà∂Êñá‰ª∂Âú®/system/bin/app_process64
// ÂêØÂä®ÂèÇÊï∞ÊòØ -Xzygote /system/bin --zygote --start-system-server --socket-name=zygote
service zygote /system/bin/app_process64 -Xzygote /system/bin --zygote --start-system-server --socket-name=zygote
    class main
    priority -20
    user root
    group root readproc
    socket zygote stream 660 root system                               // ÂàõÂª∫‰∏Ä‰∏™socketÔºåÂêçÂ≠óÂè´zygoteÔºå‰ª•tcpÂΩ¢Âºè
    onrestart write /sys/android_power/request_state wake              // onrestart ÊåáÂΩìËøõÁ®ãÈáçÂêØÊó∂ÊâßË°åÂêéÈù¢ÁöÑÂëΩ‰ª§
    onrestart write /sys/power/state on
    onrestart restart audioserver
    onrestart restart cameraserver
    onrestart restart media
    onrestart restart netd
    onrestart restart wificond
    writepid /dev/cpuset/foreground/tasks                              // ÂàõÂª∫Â≠êËøõÁ®ãÊó∂ÔºåÂêë /dev/cpuset/foreground/tasks ÂÜôÂÖ•pid

// Âè¶‰∏Ä‰∏™service ,ÂêçÂ≠ó zygote_secondary
service zygote_secondary /system/bin/app_process32 -Xzygote /system/bin --zygote --socket-name=zygote_secondary --enable-lazy-preload
    class main
    priority -20
    user root
    group root readproc
    socket zygote_secondary stream 660 root system
    onrestart restart zygote
    writepid /dev/cpuset/foreground/tasks

</code></pre><h3 id="start-zygote"><a href="#start-zygote" class="headerlink" title="start zygote"></a>start zygote</h3><p>ÂÆö‰πâ‰∫ÜserviceÔºåËÇØÂÆöÊúâÂú∞ÊñπË∞ÉÁî® start zygote„ÄÇÂú®‰πãÂâçinitËß£ÊûêÁöÑÂçöÂÆ¢‰∏≠ÔºåÊàë‰ª¨ÂàÜÊûêËøáinitËøõÁ®ãÁöÑÂêØÂä®„ÄÇinitËøõÁ®ãÂêØÂä®ÁöÑÊúÄÂêéÔºå‰ºö‰∫ßÁîü‚Äùlate-init‚Äù‰∫ã‰ª∂„ÄÇ</p>
<pre class=" language-C++"><code class="language-C++">    // Don't mount filesystems or start core system services in charger mode.
    std::string bootmode = GetProperty("ro.bootmode", "");
    if (bootmode == "charger") {
        am.QueueEventTrigger("charger");
    } else {
        am.QueueEventTrigger("late-init");
    }
</code></pre>
<p>ÂØπÂ∫î‰∫éinit.rcÈÖçÁΩÆÊñá‰ª∂‰∏≠ÔºåÊàë‰ª¨ÊâæÂà∞Â¶Ç‰∏ã‰ª£Á†ÅÔºö</p>
<pre><code># Mount filesystems and start core system services.
on late-init
    trigger early-fs
    ... ...
    # Now we can start zygote for devices with file based encryption
    trigger zygote-start                 // Ëß¶Âèë‰∫Üzygote-start‰∫ã‰ª∂ÂêéÔºåÂ∞±‰ºöÂêØÂä®zygoteËøõÁ®ã
    ... ...
</code></pre><p>ÂØπÂ∫î‰∫éinit.rcÈÖçÁΩÆÊñá‰ª∂‰∏≠ÔºåÊàë‰ª¨ÊâæÂà∞Â¶Ç‰∏ã‰ª£Á†ÅÔºö</p>
<pre><code># It is recommended to put unnecessary data/ initialization from post-fs-data
# to start-zygote in device&#39;s init.rc to unblock zygote start.
on zygote-start &amp;&amp; property:ro.crypto.state=unencrypted
    # A/B update verifier that marks a successful boot.
    exec_start update_verifier_nonencrypted       
    start netd                    // startÂØπÂ∫îÁöÑÊò†Â∞ÑÂÖ≥Á≥ªÂÆö‰πâ‰∫ésystem/core/init/builtins.cpp‰∏≠
    start zygote                  // Ë∞ÉÁî®startÂØπÂ∫îÁöÑÂ§ÑÁêÜÂáΩÊï∞ÔºåÂêØÂä®Âêç‰∏∫zygoteÁöÑÊúçÂä°Ôºà‰º†ÂÖ•ÂâçÊñáinit.zygote.rc‰∏≠ÂÆö‰πâÁöÑÂèÇÊï∞Ôºâ
    start zygote_secondary

on zygote-start &amp;&amp; property:ro.crypto.state=unsupported
    # A/B update verifier that marks a successful boot.
    exec_start update_verifier_nonencrypted
    start netd
    start zygote
    start zygote_secondary

on zygote-start &amp;&amp; property:ro.crypto.state=encrypted &amp;&amp; property:ro.crypto.type=file
    # A/B update verifier that marks a successful boot.
    exec_start update_verifier_nonencrypted
    start netd
    start zygote
    start zygote_secondary
</code></pre><p>startÂëΩ‰ª§Êúâ‰∏Ä‰∏™ÂØπÂ∫îÁöÑÊâßË°åÂáΩÊï∞do_startÔºåÂÆö‰πâÂú®platform/system/core/init/builtins.cpp‰∏≠</p>
<pre class=" language-C++"><code class="language-C++">const BuiltinFunctionMap::Map& BuiltinFunctionMap::map() const {
    constexpr std::size_t kMax = std::numeric_limits<std::size_t>::max();
    // clang-format off
    static const Map builtin_functions = {
        ... ...
        {"start",                   {1,     1,    do_start}},
        ... ...
    };
    // clang-format on
    return builtin_functions;
}
</std::size_t></code></pre>
<p>Êàë‰ª¨Êù•Áúã‰∏ãdo_start()Ôºö</p>
<pre class=" language-C++"><code class="language-C++">static int do_start(const std::vector<std::string>& args) {
    Service* svc = ServiceManager::GetInstance().FindServiceByName(args[1]);    // ÊâæÂà∞zygote serviceÂØπÂ∫î‰ø°ÊÅØ
    if (!svc) {
        LOG(ERROR) << "do_start: Service " << args[1] << " not found";
        return -1;
    }
    if (!svc->Start())         // ÂêØÂä®ÂØπÂ∫îÁöÑËøõÁ®ã
        return -1;
    return 0;
}
</std::string></code></pre>
<p>do_startÈ¶ñÂÖàÊòØÈÄöËøáFindServiceByNameÂéªserviceÊï∞ÁªÑ‰∏≠ÈÅçÂéÜÔºåÊ†πÊçÆÂêçÂ≠óÂåπÈÖçÂá∫ÂØπÂ∫îÁöÑserviceÔºåÁÑ∂ÂêéË∞ÉÁî®serviceÁöÑStartÂáΩÊï∞„ÄÇ</p>
<p>ÊúÄÂêéÔºåÊàë‰ª¨Êù•ÁúãÁúãservice.cpp‰∏≠ÂÆö‰πâStartÂáΩÊï∞Ôºö</p>
<pre class=" language-C++"><code class="language-C++">bool Service::Start() {

    ... ...

    pid_t pid = -1;
    if (namespace_flags_) {
        pid = clone(nullptr, nullptr, namespace_flags_ | SIGCHLD, nullptr);
    } else {
        pid = fork();         // ‰ªéinitËøõÁ®ã‰∏≠ÔºåforkÂá∫zygoteËøõÁ®ã
    }

    ... ...
}
</code></pre>
<p>StartÂáΩÊï∞‰∏ªË¶ÅÊòØforkÂá∫‰∏Ä‰∏™Êñ∞ËøõÁ®ãÔºåÁÑ∂ÂêéÊâßË°åserviceÂØπÂ∫îÁöÑ‰∫åËøõÂà∂Êñá‰ª∂ÔºåÂπ∂Â∞ÜÂèÇÊï∞‰º†ÈÄíËøõÂéª„ÄÇÈÇ£‰πà‰∏ãÈù¢Êàë‰ª¨‰ª•init.zygote64.rc‰∏∫‰æãËøõË°åÂàÜÊûê„ÄÇ</p>
<h2 id="app-process"><a href="#app-process" class="headerlink" title="app_process"></a>app_process</h2><p>‰ªé‰∏äÈù¢Êàë‰ª¨ÂàÜÊûêÁöÑinit.zygote64.rcÂèØ‰ª•ÁúãÂá∫Ôºåzygote64ÂêØÂä®Êñá‰ª∂ÁöÑÂú∞ÂùÄ‰∏∫app_process64„ÄÇapp_process64ÂØπÂ∫îÁöÑ‰ª£Á†ÅÂÆö‰πâÂú®frameworks/base/cmds/app_process‰∏≠Ôºå </p>
<p>Êàë‰ª¨Êù•ÁúãÁúãÂØπÂ∫îÁöÑAndroid.mkÔºö frameworks/base/cmds/app_process</p>
<pre class=" language-mk"><code class="language-mk">LOCAL_PATH:= $(call my-dir)

... ...

app_process_src_files := \
    app_main.cpp \

... ...

LOCAL_MODULE:= app_process
LOCAL_MULTILIB := both
LOCAL_MODULE_STEM_32 := app_process32
LOCAL_MODULE_STEM_64 := app_process64
</code></pre>
<p>ÂÖ∂ÂÆû‰∏çÁÆ°ÊòØapp_process„ÄÅapp_process32ËøòÊòØapp_process64ÔºåÂØπÂ∫îÁöÑÊ∫êÊñá‰ª∂ÈÉΩÊòØapp_main.cpp„ÄÇ</p>
<p>Êé•‰∏ãÊù•Êàë‰ª¨Â∞±ÁúãÁúãapp_processÂØπÂ∫îÁöÑmainÂáΩÊï∞ÔºåËØ•ÂáΩÊï∞ÂÆö‰πâ‰∫éapp_main.cpp‰∏≠„ÄÇ</p>
<p>Âú®app_main.cppÁöÑmainÂáΩÊï∞‰∏≠Ôºå‰∏ªË¶ÅÂÅöÁöÑ‰∫ãÊÉÖÂ∞±ÊòØÂèÇÊï∞Ëß£Êûê. Ëøô‰∏™ÂáΩÊï∞Êúâ‰∏§ÁßçÂêØÂä®Ê®°ÂºèÔºö</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;‚ú® ‰∏ÄÁßçÊòØzygoteÊ®°ÂºèÔºå‰πüÂ∞±ÊòØÂàùÂßãÂåñzygoteËøõÁ®ãÔºå‰º†ÈÄíÁöÑÂèÇÊï∞Êúâ‚Äìstart-system-server ‚Äìsocket-name=zygoteÔºåÂâçËÄÖË°®Á§∫ÂêØÂä®SystemServerÔºåÂêéËÄÖÊåáÂÆösocketÁöÑÂêçÁß∞ÔºàZygote64_32Ôºâ„ÄÇ<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;‚ú® ‰∏ÄÁßçÊòØapplicationÊ®°ÂºèÔºå‰πüÂ∞±ÊòØÂêØÂä®ÊôÆÈÄöÂ∫îÁî®Á®ãÂ∫èÔºå‰º†ÈÄíÁöÑÂèÇÊï∞ÊúâclassÂêçÂ≠ó‰ª•ÂèäclassÂ∏¶ÁöÑÂèÇÊï∞„ÄÇ</p>
<p>‰∏§ËÄÖÊúÄÁªàÈÉΩÊòØË∞ÉÁî®AppRuntimeÂØπË±°ÁöÑstartÂáΩÊï∞ÔºåÂä†ËΩΩZygoteInitÊàñRuntimeInit‰∏§‰∏™JavaÁ±ªÔºåÂπ∂Â∞Ü‰πãÂâçÊï¥ÁêÜÁöÑÂèÇÊï∞‰º†ÂÖ•ËøõÂéª„ÄÇ</p>
<p>Êàë‰ª¨ËøôÈáåÊöÇÊó∂Âè™ËÆ≤Ëß£ZygoteInitÁöÑÂä†ËΩΩÊµÅÁ®ã„ÄÇ</p>
<pre class=" language-C++"><code class="language-C++">int main(int argc, char* const argv[])
{
    // Â∞ÜÂèÇÊï∞argvÊîæÂà∞argv_StringÂ≠óÁ¨¶‰∏≤‰∏≠ÔºåÁÑ∂ÂêéÊâìÂç∞Âá∫Êù•
    // ‰πãÂâçstart zygote‰º†ÂÖ•ÁöÑÂèÇÊï∞ÊòØ -Xzygote /system/bin --zygote --start-system-server
    if (!LOG_NDEBUG) {
      String8 argv_String;
      for (int i = 0; i < argc; ++i) {
        argv_String.append("\"");
        argv_String.append(argv[i]);
        argv_String.append("\" ");
      }
      ALOGV("app_process main with argv: %s", argv_String.string());
    }

    // AppRuntimeÂÆö‰πâ‰∫éapp_main.cpp‰∏≠ÔºåÁªßÊâøËá™AndroidRuntime
    // Â∞±ÊòØÂØπAndroidËøêË°åÁéØÂ¢ÉÁöÑ‰∏ÄÁßçÊäΩË±°ÔºåÁ±ª‰ºº‰∫éjavaËôöÊãüÊú∫ÂØπJavaÁ®ãÂ∫èÁöÑ‰ΩúÁî®
    AppRuntime runtime(argv[0], computeArgBlockSize(argc, argv));
    // Process command line arguments
    // ignore argv[0]
    argc--;
    argv++;

    // Ëøô‰∏§‰∏™ÂèÇÊï∞ÊòØJavaÁ®ãÂ∫èÈúÄË¶Å‰æùËµñÁöÑJarÂåÖÔºåÁõ∏ÂΩì‰∫éimport
    const char* spaced_commands[] = { "-cp", "-classpath" };
    // Allow "spaced commands" to be succeeded by exactly 1 argument (regardless of -s).
    bool known_command = false;

    int i;
    // ÊâæÂà∞Ëß£ÊûêÂèÇÊï∞ÁöÑËµ∑ÁÇπ
    for (i = 0; i < argc; i++) {
        // Â∞Üspaced_commands‰∏≠ÁöÑÂèÇÊï∞È¢ùÂ§ñÂä†ÂÖ•VM
        if (known_command == true) {
          runtime.addOption(strdup(argv[i]));
          // The static analyzer gets upset that we don't ever free the above
          // string. Since the allocation is from main, leaking it doesn't seem
          // problematic. NOLINTNEXTLINE
          ALOGV("app_process main add known option '%s'", argv[i]);
          known_command = false;
          continue;
        }

        for (int j = 0;
             j < static_cast<int>(sizeof(spaced_commands) / sizeof(spaced_commands[0]));
             ++j) {
            // ÊØîËæÉÂèÇÊï∞ÊòØÂê¶ÊòØspaced_commands‰∏≠ÁöÑÂèÇÊï∞
          if (strcmp(argv[i], spaced_commands[j]) == 0) {
            known_command = true;
            ALOGV("app_process main found known command '%s'", argv[i]);
          }
        }

        // Â¶ÇÊûúÂèÇÊï∞Á¨¨‰∏Ä‰∏™Â≠óÁ¨¶ÊòØ'-'ÔºåÁõ¥Êé•Ë∑≥Âá∫Âæ™ÁéØÔºå‰πãÂâç‰º†ÂÖ•ÁöÑÁ¨¨‰∏Ä‰∏™ÂèÇÊï∞ÊòØ -XzygoteÔºåÊâÄ‰ª•ÊâßË°åÂà∞ËøôÂÑøÂ∞±Ë∑≥Âá∫‰∫Ü
        if (argv[i][0] != '-') {
            break;
        }
        if (argv[i][1] == '-' && argv[i][2] == 0) {
            ++i; // Skip --.
            break;
        }

        runtime.addOption(strdup(argv[i]));
        // The static analyzer gets upset that we don't ever free the above
        // string. Since the allocation is from main, leaking it doesn't seem
        // problematic. NOLINTNEXTLINE
        ALOGV("app_process main add option '%s'", argv[i]);
    }

    // Parse runtime arguments.  Stop at first unrecognized option.
    // ‰ªéËøôÈáåÂÖ∂ÂÆûÂèØ‰ª•ÁúãÂá∫ÔºåÈÄöËøáapp_mainÂèØ‰ª•ÂêØÂä®zygote„ÄÅsystem-serverÂèäÊôÆÈÄöapkËøõÁ®ã
    // Ëøô‰∏™ÂèØ‰ª•ÈÄöËøáinit.rcÊù•ÈÖçÁΩÆ
    bool zygote = false;
    bool startSystemServer = false;
    bool application = false;
    String8 niceName;                              // app_processÁöÑÂêçÁß∞Êîπ‰∏∫zygote
    String8 className;                             // ÂêØÂä®apkËøõÁ®ãÊó∂ÔºåÂØπÂ∫îÁöÑÁ±ªÂêç

    ++i;  // Skip unused "parent dir" argument.
    // Ë∑≥Ëøá‰∏Ä‰∏™ÂèÇÊï∞Ôºå‰πãÂâçË∑≥Ëøá‰∫Ü-XzygoteÔºåËøôÈáåÁªßÁª≠Ë∑≥Ëøá /system/bin ,‰πüÂ∞±ÊòØÊâÄË∞ìÁöÑ "parent dir"
    while (i < argc) {                             // ÂºÄÂßãËß£ÊûêËæìÂÖ•ÂèÇÊï∞
        const char* arg = argv[i++];
        if (strcmp(arg, "--zygote") == 0) {        // Ë°®Á§∫ÊòØzygoteÂêØÂä®Ê®°Âºè
            zygote = true;
            niceName = ZYGOTE_NICE_NAME;           // Ëøô‰∏™ÂÄºÊ†πÊçÆÂπ≥Âè∞ÂèØËÉΩÊòØzygote64Êàñzygote
        } else if (strcmp(arg, "--start-system-server") == 0) {
            startSystemServer = true;              // init.zygote.rc‰∏≠ÂÆö‰πâ‰∫ÜËØ•Â≠óÊÆµÔºåÂêØÂä®zygoteÂêé‰ºöÂêØÂä®system-server
        } else if (strcmp(arg, "--application") == 0) {
            application = true;                    // Ë°®Á§∫ÊòØapplicationÂêØÂä®Ê®°ÂºèÔºå‰πüÂ∞±ÊòØÊôÆÈÄöÂ∫îÁî®Á®ãÂ∫è
        } else if (strncmp(arg, "--nice-name=", 12) == 0) {
            niceName.setTo(arg + 12);              // ËøõÁ®ãÂà´ÂêçÔºåÂèØ‰ª•Ëá™Â∑±ÊåáÂÆöËøõÁ®ãÂêç
        } else if (strncmp(arg, "--", 2) != 0) {
            className.setTo(arg);                  // ‰∏é--applicationÈÖçÁΩÆÔºåÂêØÂä®ÊåáÂÆöÁöÑÁ±ªÔºåapplicationÂêØÂä®ÁöÑclass
            break;
        } else {
            --i;
            break;
        }
    }

    // ÂáÜÂ§áÂèÇÊï∞
    Vector<string8> args;
    if (!className.isEmpty()) {                    // className‰∏ç‰∏∫Á©∫ÔºåËØ¥ÊòéÊòØapplicationÂêØÂä®Ê®°Âºè
        // We're not in zygote mode, the only argument we need to pass
        // to RuntimeInit is the application argument.
        //
        // The Remainder of args get passed to startup class main(). Make
        // copies of them before we overwrite them with the process name.
        args.add(application ? String8("application") : String8("tool"));
        runtime.setClassNameAndArgs(className, argc - i, argv + i);    // Â∞ÜclassNameÂíåÂèÇÊï∞ËÆæÁΩÆÁªôruntime

        ... ...

    } else {                                       // zygoteÂêØÂä®Ê®°Âºè
        // We're in zygote mode.
        maybeCreateDalvikCache();                  // ÂàõÂª∫DalvikÁöÑÁºìÂ≠òÁõÆÂΩïÂπ∂ÂÆö‰πâÊùÉÈôê

        if (startSystemServer) {                   // Â¢ûÂä†start-system-serverÂèÇÊï∞ÔºåÈªòËÆ§ÂêØÂä®zygoteÂêéÔºåÂ∞±‰ºöÂêØÂä®system_server
            args.add(String8("start-system-server"));
        }

        char prop[PROP_VALUE_MAX];                 // Ëé∑ÂèñÂπ≥Âè∞ÂØπÂ∫îÁöÑabi‰ø°ÊÅØ
        if (property_get(ABI_LIST_PROPERTY, prop, NULL) == 0) {
            LOG_ALWAYS_FATAL("app_process: Unable to determine ABI list from property %s.",
                ABI_LIST_PROPERTY);
            return 11;
        }

        String8 abiFlag("--abi-list=");            // ÂèÇÊï∞ÈúÄË¶ÅÂà∂ÂÆöabi
        abiFlag.append(prop);
        args.add(abiFlag);                         // Âä†ÂÖ•--abi-list=ÂèÇÊï∞

        // In zygote mode, pass all remaining arguments to the zygote
        // main() method.
        for (; i < argc; ++i) {
            args.add(String8(argv[i]));            // Â∞ÜÂâ©‰∏ãÁöÑÂèÇÊï∞Âä†ÂÖ•args
        }
    }

    if (!niceName.isEmpty()) {                     // Â∞Üapp_processÁöÑËøõÁ®ãÂêçÔºåÊõøÊç¢‰∏∫niceName
        runtime.setArgv0(niceName.string(), true /* setProcName */);
    }

    if (zygote) {                                  // Ë∞ÉÁî®RuntimeÁöÑstartÂáΩÊï∞, ÂêØÂä®ZygoteInit
        runtime.start("com.android.internal.os.ZygoteInit", args, zygote);
    } else if (className) {                        // ÂêØÂä®zygoteÊ≤°ÊúâËøõÂÖ•Ëøô‰∏™ÂàÜÊîØ
        // ‰ΩÜËøô‰∏™ÂàÜÊîØËØ¥ÊòéÔºåÈÄöËøáÈÖçÁΩÆinit.rcÊñá‰ª∂ÔºåÂÖ∂ÂÆûÊòØÂèØ‰ª•‰∏çÈÄöËøázygoteÊù•ÂêØÂä®‰∏Ä‰∏™ËøõÁ®ã
        // Â¶ÇÊûúÊòØapplicationÂêØÂä®Ê®°ÂºèÔºåÂàôÂä†ËΩΩRuntimeInit
        runtime.start("com.android.internal.os.RuntimeInit", args, zygote);
    } else {
        // errorÊÉÖÂÜµ
        fprintf(stderr, "Error: no class name or --zygote supplied.\n");
        app_usage();
        LOG_ALWAYS_FATAL("app_process: no class name or --zygote supplied.");
    }
}

</string8></int></code></pre>
<h2 id="AndroidRuntime"><a href="#AndroidRuntime" class="headerlink" title="AndroidRuntime"></a>AndroidRuntime</h2><p>Áî±‰∫éAppRuntimeÁªßÊâøËá™AndroidRuntimeÔºå‰∏îÊ≤°ÊúâÈáçÂÜôstartÊñπÊ≥ïÔºåÂõ†Ê≠§zygoteÁöÑÊµÅÁ®ãËøõÂÖ•Âà∞‰∫ÜAndroidRuntime.cpp„ÄÇ</p>
<p>Êé•‰∏ãÊù•ÔºåÊàë‰ª¨Êù•ÁúãÁúãAndroidRuntimeÁöÑstartÂáΩÊï∞ÁöÑÊµÅÁ®ã„ÄÇ</p>
<h3 id="ÂàõÂª∫JavaËôöÊãüÊú∫"><a href="#ÂàõÂª∫JavaËôöÊãüÊú∫" class="headerlink" title="ÂàõÂª∫JavaËôöÊãüÊú∫"></a>ÂàõÂª∫JavaËôöÊãüÊú∫</h3><pre class=" language-C++"><code class="language-C++">/*
 * Start the Android runtime.  This involves starting the virtual machine
 * and calling the "static void main(String[] args)" method in the class
 * named by "className".
 *
 * Passes the main function two arguments, the class name and the specified
 * options string.
 */
void AndroidRuntime::start(const char* className, const Vector<string8>& options, bool zygote)
{
    ... ...                                   // ÊâìÂç∞‰∏Ä‰∫õÊó•ÂøóÔºåËé∑ÂèñANDROID_ROOTÁéØÂ¢ÉÂèòÈáè

    /* start the virtual machine */
    JniInvocation jni_invocation;
    jni_invocation.Init(NULL);                // ÂàùÂßãÂåñJNI,Âä†ËΩΩlibart.so
    JNIEnv* env;
    // ÂàõÂª∫ËôöÊãüÊú∫ÔºåÂÖ∂‰∏≠Â§ßÂ§öÊï∞ÂèÇÊï∞Áî±Á≥ªÁªüÂ±ûÊÄßÂÜ≥ÂÆö
    // ÊúÄÁªàÔºåstartVmÂà©Áî®JNI_CreateJavaVMÂàõÂª∫Âá∫ËôöÊãüÊú∫
    if (startVm(&mJavaVM, &env, zygote) != 0) {
        return;
    }
    // ÂõûË∞ÉAppRuntimeÁöÑonVmCreatedÂáΩÊï∞
    // ÂØπ‰∫ézygoteËøõÁ®ãÁöÑÂêØÂä®ÊµÅÁ®ãËÄåË®ÄÔºåÊó†ÂÆûÈôÖÊìç‰ΩúÔºåË°®Á§∫ËôöÊãüÂàõÂª∫ÂÆåÊàêÔºå‰ΩÜÊòØÈáåÈù¢ÊòØÁ©∫ÂÆûÁé∞
    onVmCreated(env);

    ... ...
}
</string8></code></pre>
<p>ËøôËæπÊàë‰ª¨Ë∑ü‰∏Ä‰∏ãjni_invocation.Init()Ôºölibnativehelper/JniInvocation.cpp</p>
<p>InitÂáΩÊï∞‰∏ªË¶Å‰ΩúÁî®ÊòØÂàùÂßãÂåñJNIÔºåÂÖ∑‰ΩìÂ∑•‰ΩúÊòØÈ¶ñÂÖàÈÄöËøádlopenÂä†ËΩΩlibart.soËé∑ÂæóÂÖ∂Âè•ÊüÑÔºåÁÑ∂ÂêéË∞ÉÁî®dlsym‰ªélibart.so‰∏≠ÊâæÂà∞JNI_GetDefaultJavaVMInitArgs„ÄÅJNI_CreateJavaVM„ÄÅJNI_GetCreatedJavaVMs‰∏â‰∏™ÂáΩÊï∞Âú∞ÂùÄÔºåËµãÂÄºÁªôÂØπÂ∫îÊàêÂëòÂ±ûÊÄßÔºåËøô‰∏â‰∏™ÂáΩÊï∞‰ºöÂú®ÂêéÁª≠ËôöÊãüÊú∫ÂàõÂª∫‰∏≠Ë∞ÉÁî®„ÄÇ</p>
<pre class=" language-C++"><code class="language-C++">bool JniInvocation::Init(const char* library) {
#ifdef __ANDROID__
  char buffer[PROP_VALUE_MAX];
#else
  char* buffer = NULL;
#endif
  library = GetLibrary(library, buffer);              // ÈªòËÆ§ËøîÂõû libart.so
  // Load with RTLD_NODELETE in order to ensure that libart.so is not unmapped when it is closed.
  // This is due to the fact that it is possible that some threads might have yet to finish
  // exiting even after JNI_DeleteJavaVM returns, which can lead to segfaults if the library is
  // unloaded.
  const int kDlopenFlags = RTLD_NOW | RTLD_NODELETE;

  /*
   * 1.dlopenÂäüËÉΩÊòØ‰ª•ÊåáÂÆöÊ®°ÂºèÊâìÂºÄÊåáÂÆöÁöÑÂä®ÊÄÅÈìæÊé•Â∫ìÊñá‰ª∂ÔºåÂπ∂ËøîÂõû‰∏Ä‰∏™Âè•ÊüÑ
   * 2.RTLD_NOWË°®Á§∫ÈúÄË¶ÅÂú®dlopenËøîÂõûÂâçÔºåËß£ÊûêÂá∫ÊâÄÊúâÊú™ÂÆö‰πâÁ¨¶Âè∑ÔºåÂ¶ÇÊûúËß£Êûê‰∏çÂá∫Êù•ÔºåÂú®dlopen‰ºöËøîÂõûNULL
   * 3.RTLD_NODELETEË°®Á§∫Âú®dlclose()ÊúüÈó¥‰∏çÂç∏ËΩΩÂ∫ìÔºåÂπ∂‰∏îÂú®‰ª•Âêé‰ΩøÁî®dlopen()ÈáçÊñ∞Âä†ËΩΩÂ∫ìÊó∂‰∏çÂàùÂßãÂåñÂ∫ì‰∏≠ÁöÑÈùôÊÄÅÂèòÈáè
   */
  handle_ = dlopen(library, kDlopenFlags);            // Ëé∑Âèñlibart.soÁöÑÂè•ÊüÑ
  if (handle_ == NULL) {                              // Ëé∑ÂèñÂ§±Ë¥•ÊâìÂç∞ÈîôËØØÊó•ÂøóÂπ∂Â∞ùËØïÂÜçÊ¨°ÊâìÂºÄlibart.so
    if (strcmp(library, kLibraryFallback) == 0) {
      // Nothing else to try.
      ALOGE("Failed to dlopen %s: %s", library, dlerror());
      return false;
    }
    // Note that this is enough to get something like the zygote
    // running, we can't property_set here to fix this for the future
    // because we are root and not the system user. See
    // RuntimeInit.commonInit for where we fix up the property to
    // avoid future fallbacks. http://b/11463182
    ALOGW("Falling back from %s to %s after dlopen error: %s",
          library, kLibraryFallback, dlerror());
    library = kLibraryFallback;
    handle_ = dlopen(library, kDlopenFlags);
    if (handle_ == NULL) {
      ALOGE("Failed to dlopen %s: %s", library, dlerror());
      return false;
    }
  }

  /*
   * 1.FindSymbolÂáΩÊï∞ÂÜÖÈÉ®ÂÆûÈôÖË∞ÉÁî®ÁöÑÊòØdlsym
   * 2.dlsym‰ΩúÁî®ÊòØÊ†πÊçÆ Âä®ÊÄÅÈìæÊé•Â∫ì Êìç‰ΩúÂè•ÊüÑ(handle)‰∏éÁ¨¶Âè∑(symbol)ÔºåËøîÂõûÁ¨¶Âè∑ÂØπÂ∫îÁöÑÂú∞ÂùÄ
   * 3.ËøôÈáåÂÆûÈôÖÂ∞±ÊòØ‰ªélibart.so‰∏≠Â∞ÜJNI_GetDefaultJavaVMInitArgsÁ≠âÂØπÂ∫îÁöÑÂú∞ÂùÄÂ≠òÂÖ•&JNI_GetDefaultJavaVMInitArgs_‰∏≠
   */
  if (!FindSymbol(reinterpret_cast<void**>(&JNI_GetDefaultJavaVMInitArgs_),
                  "JNI_GetDefaultJavaVMInitArgs")) {
    return false;
  }
  if (!FindSymbol(reinterpret_cast<void**>(&JNI_CreateJavaVM_),
                  "JNI_CreateJavaVM")) {
    return false;
  }
  if (!FindSymbol(reinterpret_cast<void**>(&JNI_GetCreatedJavaVMs_),
                  "JNI_GetCreatedJavaVMs")) {
    return false;
  }
  return true;
}
</void**></void**></void**></code></pre>
<p>ÂÖ∂Ê¨°ÔºåÊàë‰ª¨ÂÜçË∑ü‰∏Ä‰∏ãstartVm()Ôºö</p>
<p>Ëøô‰∏™ÂáΩÊï∞ÁâπÂà´ÈïøÔºå‰ΩÜÊòØÈáåÈù¢ÂÅöÁöÑ‰∫ãÊÉÖÂæàÂçï‰∏ÄÔºåÂÖ∂ÂÆûÂ∞±ÊòØ‰ªéÂêÑÁßçÁ≥ªÁªüÂ±ûÊÄß‰∏≠ËØªÂèñ‰∏Ä‰∫õÂèÇÊï∞ÔºåÁÑ∂ÂêéÈÄöËøáaddOptionËÆæÁΩÆÂà∞AndroidRuntimeÁöÑmOptionsÊï∞ÁªÑ‰∏≠Â≠òËµ∑Êù•ÔºåÂè¶Â§ñÂ∞±ÊòØË∞ÉÁî®‰πãÂâç‰ªélibart.so‰∏≠ÊâæÂà∞JNI_CreateJavaVMÂáΩÊï∞ÔºåÂπ∂Â∞ÜËøô‰∫õÂèÇÊï∞‰º†ÂÖ•ÔºåÁî±‰∫éÊú¨ÁØá‰∏ªË¶ÅËÆ≤zygoteÂêØÂä®ÊµÅÁ®ãÔºåÂõ†Ê≠§ÂÖ≥‰∫éËôöÊãüÊú∫ÁöÑÂÆûÁé∞Â∞±‰∏çÊ∑±ÂÖ•Êé¢Á©∂‰∫Ü„ÄÇ</p>
<pre class=" language-C++"><code class="language-C++">int AndroidRuntime::startVm(JavaVM** pJavaVM, JNIEnv** pEnv, bool zygote)
{
    JavaVMInitArgs initArgs;
    char propBuf[PROPERTY_VALUE_MAX];
    char stackTraceFileBuf[sizeof("-Xstacktracefile:")-1 + PROPERTY_VALUE_MAX];
    char jniOptsBuf[sizeof("-Xjniopts:")-1 + PROPERTY_VALUE_MAX];

    ... ...

    /* route exit() to our handler */
    addOption("exit", (void*) runtime_exit);                                    // Â∞ÜÂèÇÊï∞ÊîæÂÖ•mOptionsÊï∞ÁªÑ‰∏≠

    ... ...

    initArgs.version = JNI_VERSION_1_4;
    initArgs.options = mOptions.editArray();                                    // Â∞ÜmOptionsËµãÂÄºÁªôinitArgs
    initArgs.nOptions = mOptions.size();
    initArgs.ignoreUnrecognized = JNI_FALSE;

    /*
     * Initialize the VM.
     *
     * The JavaVM* is essentially per-process, and the JNIEnv* is per-thread.
     * If this call succeeds, the VM is ready, and we can start issuing
     * JNI calls.
     */
    if (JNI_CreateJavaVM(pJavaVM, pEnv, &initArgs) < 0) {                       // Ë∞ÉÁî®libart.soÁöÑJNI_CreateJavaVMÂáΩÊï∞
        ALOGE("JNI_CreateJavaVM failed\n");
        return -1;
    }

    return 0;
}
</code></pre>
<h3 id="Ê≥®ÂÜåJNIÂáΩÊï∞"><a href="#Ê≥®ÂÜåJNIÂáΩÊï∞" class="headerlink" title="Ê≥®ÂÜåJNIÂáΩÊï∞"></a>Ê≥®ÂÜåJNIÂáΩÊï∞</h3><p>Êàë‰ª¨ÂõûÂà∞AndroidRuntimeÁöÑstartÂáΩÊï∞„ÄÇÂàùÂßãÂåñJVMÂêéÔºåÊé•‰∏ãÊù•Â∞±‰ºöË∞ÉÁî®startRegÂáΩÊï∞„ÄÇ</p>
<pre class=" language-C++"><code class="language-C++">void AndroidRuntime::start(const char* className, const Vector<string8>& options, bool zygote)
{
    ... ...

    /* 01. ÂàõÂª∫JavaËôöÊãüÊú∫*/

    /*
     * Register android functions.
     */
    if (startReg(env) < 0) {         // Ê≥®ÂÜåJNIÂáΩÊï∞
        ALOGE("Unable to register all android natives\n");
        return;
    }
    ... ...
}
</string8></code></pre>
<p>startRegÈ¶ñÂÖàÊòØËÆæÁΩÆ‰∫ÜAndroidÂàõÂª∫Á∫øÁ®ãÁöÑÂ§ÑÁêÜÂáΩÊï∞ÔºåÁÑ∂ÂêéÂàõÂª∫‰∫Ü‰∏Ä‰∏™200ÂÆπÈáèÁöÑÂ±ÄÈÉ®ÂºïÁî®‰ΩúÁî®ÂüüÔºåÁî®‰∫éÁ°Æ‰øù‰∏ç‰ºöÂá∫Áé∞OutOfMemoryExceptionÔºåÊúÄÂêéÂ∞±ÊòØË∞ÉÁî®register_jni_procsËøõË°åJNIÊ≥®ÂÜå„ÄÇ</p>
<p>Êàë‰ª¨Ë∑üËøõstartReg()Ôºö</p>
<pre class=" language-C++"><code class="language-C++">/*
 * Register android native functions with the VM.
 */
/*static*/ int AndroidRuntime::startReg(JNIEnv* env)
{
    ATRACE_NAME("RegisterAndroidNatives");
    /*
     * This hook causes all future threads created in this process to be
     * attached to the JavaVM.  (This needs to go away in favor of JNI
     * Attach calls.)
     */

    // ÂÆö‰πâAndroidÂàõÂª∫Á∫øÁ®ãÁöÑfuncÔºöjavaCreateThreadEtcÔºåËøô‰∏™ÂáΩÊï∞ÂÜÖÈÉ®ÊòØÈÄöËøáLinuxÁöÑcloneÊù•ÂàõÂª∫Á∫øÁ®ãÁöÑ
    androidSetCreateThreadFunc((android_create_thread_fn) javaCreateThreadEtc);       

    ALOGV("--- registering native functions ---\n");

    /*
     * Every "register" function calls one or more things that return
     * a local reference (e.g. FindClass).  Because we haven't really
     * started the VM yet, they're all getting stored in the base frame
     * and never released.  Use Push/Pop to manage the storage.
     */
    env->PushLocalFrame(200);        // ÂàõÂª∫‰∏Ä‰∏™200ÂÆπÈáèÁöÑÂ±ÄÈÉ®ÂºïÁî®‰ΩúÁî®Âüü,Ëøô‰∏™Â±ÄÈÉ®ÂºïÁî®ÂÖ∂ÂÆûÂ∞±ÊòØÂ±ÄÈÉ®ÂèòÈáè

    if (register_jni_procs(gRegJNI, NELEM(gRegJNI), env) < 0) {       // Ê≥®ÂÜåJNIÂáΩÊï∞
        env->PopLocalFrame(NULL);
        return -1;
    }

    env->PopLocalFrame(NULL);                                         // ÈáäÊîæÂ±ÄÈÉ®ÂºïÁî®‰ΩúÁî®Âüü

    //createJavaThread("fubar", quickTest, (void*) "hello");

    return 0;
}
</code></pre>
<p>‰ªé‰∏äËø∞‰ª£Á†ÅÂèØ‰ª•ÁúãÂá∫ÔºåstartRegÂáΩÊï∞‰∏≠‰∏ªË¶ÅÊòØÈÄöËøáregister_jni_procsÊù•Ê≥®ÂÜåJNIÂáΩÊï∞„ÄÇÂÖ∂‰∏≠ÔºågRegJNIÊòØ‰∏Ä‰∏™ÂÖ®Â±ÄÊï∞ÁªÑÔºåËØ•Êï∞ÁªÑÁöÑÂÆö‰πâÂ¶Ç‰∏ãÔºö</p>
<pre class=" language-C++"><code class="language-C++">static const RegJNIRec gRegJNI[] = {                                  // ÈáåÈù¢Â∞±ÊòØ‰∏ÄÂ†ÜÁöÑÂáΩÊï∞ÊåáÈíà
    REG_JNI(register_com_android_internal_os_RuntimeInit),
    REG_JNI(register_com_android_internal_os_ZygoteInit_nativeZygoteInit),
    REG_JNI(register_android_os_SystemClock),
    REG_JNI(register_android_util_EventLog),
    REG_JNI(register_android_util_Log),
    ... ...
};

</code></pre>
<p>Êàë‰ª¨Êåë‰∏Ä‰∏™register_com_android_internal_os_ZygoteInit_nativeZygoteInitÔºåËøôÂÆûÈôÖ‰∏äÊòØËá™ÂÆö‰πâJNIÂáΩÊï∞Âπ∂ËøõË°åÂä®ÊÄÅÊ≥®ÂÜåÁöÑÊ†áÂáÜÂÜôÊ≥ï,<br>ÂÜÖÈÉ®ÊòØË∞ÉÁî®JNIÁöÑRegisterNativesÔºåËøôÊ†∑Ê≥®ÂÜåÂêéÔºåJavaÁ±ªZygoteInitÁöÑnativeÊñπÊ≥ïnativeZygoteInitÂ∞±‰ºöË∞ÉÁî®com_android_internal_os_ZygoteInit_nativeZygoteInitÂáΩÊï∞„ÄÇ</p>
<pre class=" language-C++"><code class="language-C++">int register_com_android_internal_os_ZygoteInit_nativeZygoteInit(JNIEnv* env)
{
    const JNINativeMethod methods[] = {
        { "nativeZygoteInit", "()V",
            (void*) com_android_internal_os_ZygoteInit_nativeZygoteInit },
    };
    return jniRegisterNativeMethods(env, "com/android/internal/os/ZygoteInit",
        methods, NELEM(methods));
}
</code></pre>
<p>REG_JNIÂØπÂ∫îÁöÑÂÆèÂÆö‰πâÂèäRegJNIRecÁªìÊûÑ‰ΩìÁöÑÂÆö‰πâ‰∏∫Ôºö</p>
<pre class=" language-C++"><code class="language-C++">#ifdef NDEBUG
    #define REG_JNI(name)      { name }
    struct RegJNIRec {
        int (*mProc)(JNIEnv*);
    };
#else
    #define REG_JNI(name)      { name, #name }
    struct RegJNIRec {
        int (*mProc)(JNIEnv*);
        const char* mName;
    };
#endif
</code></pre>
<p>Ê†πÊçÆÂÆèÂÆö‰πâÂèØ‰ª•ÁúãÂá∫ÔºåÂÆèREG_JNIÂ∞ÜÂæóÂà∞ÂáΩÊï∞ÂêçÔºõÂÆö‰πâRegJNIRecÊï∞ÁªÑÊó∂ÔºåÂáΩÊï∞ÂêçË¢´ËµãÂÄºÁªôRegJNIRecÁªìÊûÑ‰ΩìÔºå‰∫éÊòØÊØè‰∏™ÂáΩÊï∞ÂêçË¢´Âº∫Ë°åËΩ¨Êç¢‰∏∫ÂáΩÊï∞ÊåáÈíà„ÄÇ<br>Âõ†Ê≠§Ôºåregister_jni_procsÁöÑÂèÇÊï∞Â∞±ÊòØ‰∏Ä‰∏™ÂáΩÊï∞ÊåáÈíàÊï∞ÁªÑÔºåÊï∞ÁªÑÁöÑÂ§ßÂ∞èÂíåJNIEnv„ÄÇ</p>
<p>Êàë‰ª¨Êù•Ë∑üËøõ‰∏Ä‰∏ãregister_jni_procsÂáΩÊï∞Ôºö</p>
<pre class=" language-C++"><code class="language-C++">static int register_jni_procs(const RegJNIRec array[], size_t count, JNIEnv* env)
{
    for (size_t i = 0; i < count; i++) {
        if (array[i].mProc(env) < 0) {              // Ë∞ÉÁî®mProc
#ifndef NDEBUG
            ALOGD("----------!!! %s failed to load\n", array[i].mName);
#endif
            return -1;
        }
    }
    return 0;
}
</code></pre>
<p>ÁªìÂêàÂâçÈù¢ÁöÑÂàÜÊûêÔºåÂÆπÊòìÁü•ÈÅìregister_jni_procsÂáΩÊï∞ÔºåÂÆûÈôÖ‰∏äÂ∞±ÊòØË∞ÉÁî®ÂáΩÊï∞ÊåáÈíàÔºàmProcÔºâÂØπÂ∫îÁöÑÂáΩÊï∞Ôºå‰ª•ËøõË°åÂÆûÈôÖÁöÑJNIÂáΩÊï∞Ê≥®ÂÜå„ÄÇ</p>
<h3 id="ÂèçÂ∞ÑÂêØÂä®ZygoteInit"><a href="#ÂèçÂ∞ÑÂêØÂä®ZygoteInit" class="headerlink" title="ÂèçÂ∞ÑÂêØÂä®ZygoteInit"></a>ÂèçÂ∞ÑÂêØÂä®ZygoteInit</h3><p>ÁªßÁª≠ÂàÜÊûêAndroidRuntime.cppÁöÑstartÂáΩÊï∞Ôºö</p>
<pre class=" language-C++"><code class="language-C++">void AndroidRuntime::start(const char* className, const Vector<string8>& options, bool zygote)
{
    ... ...

    /* 01. ÂàõÂª∫JavaËôöÊãüÊú∫*/
    /* 02. Ê≥®ÂÜåJNIÂáΩÊï∞ */

    /*
     * Start VM.  This thread becomes the main thread of the VM, and will
     * not return until the VM exits.
     */

    // ÊõøÊç¢string‰∏∫ÂÆûÈôÖË∑ØÂæÑ
    // ‰æãÂ¶ÇÔºöÂ∞Ü "com.android.internal.os.ZygoteInit" ÊõøÊç¢‰∏∫ "com/android/internal/os/ZygoteInit"
    char* slashClassName = toSlashClassName(className != NULL ? className : "");

    jclass startClass = env->FindClass(slashClassName);                    // ÊâæÂà∞classÊñá‰ª∂
    if (startClass == NULL) {
        ALOGE("JavaVM unable to locate class '%s'\n", slashClassName);
        /* keep going */
    } else {
        jmethodID startMeth = env->GetStaticMethodID(startClass, "main",
            "([Ljava/lang/String;)V");                                     // ÈÄöËøáÂèçÂ∞ÑÊâæÂà∞ZygoteInitÁöÑmainÂáΩÊï∞
        if (startMeth == NULL) {
            ALOGE("JavaVM unable to find main() in '%s'\n", className);
            /* keep going */
        } else {
            env->CallStaticVoidMethod(startClass, startMeth, strArray);    // Ë∞ÉÁî®ZygoteInitÁöÑmainÂáΩÊï∞
            ... ...
        }
    }
    free(slashClassName);

    ALOGD("Shutting down VM\n");
    if (mJavaVM->DetachCurrentThread() != JNI_OK)                          // ÈÄÄÂá∫ÂΩìÂâçÁ∫øÁ®ã
        ALOGW("Warning: unable to detach main thread\n");
    if (mJavaVM->DestroyJavaVM() != 0)                                     // ÂàõÂª∫‰∏Ä‰∏™Á∫øÁ®ãÔºåËØ•Á∫øÁ®ã‰ºöÁ≠âÂæÖÊâÄÊúâÂ≠êÁ∫øÁ®ãÁªìÊùüÂêéÂÖ≥Èó≠ËôöÊãüÊú∫
        ALOGW("Warning: VM did not shut down cleanly\n");
}
</string8></code></pre>
<p>ÂèØ‰ª•ÁúãÂà∞ÔºåÂú®AndroidRuntimeÁöÑÊúÄÂêéÔºåÂ∞ÜÈÄöËøáÂèçÂ∞ÑË∞ÉÁî®ZygoteInitÁöÑmainÂáΩÊï∞„ÄÇËá≥Ê≠§Ôºå<strong><font color="#87CEFA">zygoteËøõÁ®ãËøõÂÖ•‰∫Üjava‰∏ñÁïå</font></strong>„ÄÇ </p>
<p>ÂÖ∂ÂÆûÊàë‰ª¨‰ªîÁªÜÊÉ≥‰∏ÄÊÉ≥ÔºåÂ∞±‰ºöËßâÂæózygoteÁöÑÊï¥‰∏™ÊµÅÁ®ãÂÆûÈôÖ‰∏äÊòØÈùûÂ∏∏Á¨¶ÂêàÂÆûÈôÖÊÉÖÂÜµÁöÑ„ÄÇ<br>&nbsp;&nbsp;&nbsp;&nbsp;‚ú®‚ú® Âú®Android‰∏≠ÔºåÊØè‰∏™ËøõÁ®ãÈÉΩËøêË°åÂú®ÂØπÂ∫îÁöÑËôöÊãüÊú∫‰∏äÔºåÂõ†Ê≠§zygoteÈ¶ñÂÖàÂ∞±Ë¥üË¥£ÂàõÂª∫Âá∫ËôöÊãüÊú∫„ÄÇ<br>&nbsp;&nbsp;&nbsp;&nbsp;‚ú®‚ú® ÁÑ∂ÂêéÔºå‰∏∫‰∫ÜÂèçÂ∞ÑË∞ÉÁî®java‰ª£Á†ÅÔºåÂøÖÈ°ªÊúâÂØπÂ∫îÁöÑJNIÂáΩÊï∞Ôºå‰∫éÊòØzygoteËøõË°å‰∫ÜJNIÂáΩÊï∞ÁöÑÊ≥®ÂÜå„ÄÇ<br>&nbsp;&nbsp;&nbsp;&nbsp;‚ú®‚ú® ÂΩì‰∏ÄÂàáÂáÜÂ§áÂ¶•ÂΩìÂêéÔºåzygoteËøõÁ®ãÊâçËøõÂÖ•Âà∞‰∫Üjava‰∏ñÁïå„ÄÇ</p>
<h2 id="ZygoteInit"><a href="#ZygoteInit" class="headerlink" title="ZygoteInit"></a>ZygoteInit</h2><p>Áé∞Âú®Êàë‰ª¨Ë∑üËøõZygoteInit.javaÁöÑmainÂáΩÊï∞„ÄÇ</p>
<pre class=" language-java"><code class="language-java">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//ÂàõÂª∫ZygoteServerÂØπË±°</span>
        ZygoteServer zygoteServer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZygoteServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                             

        <span class="token comment" spellcheck="true">// Mark zygote start. This ensures that thread creation will throw</span>
        <span class="token comment" spellcheck="true">// an error.</span>
        <span class="token comment" spellcheck="true">// Ë∞ÉÁî®nativeÂáΩÊï∞ÔºåÁ°Æ‰øùÂΩìÂâçÊ≤°ÊúâÂÖ∂ÂÆÉÁ∫øÁ®ãÂú®ËøêË°å</span>
        <span class="token comment" spellcheck="true">// ‰∏ªË¶ÅËøòÊòØÂ§Ñ‰∫éÂÆâÂÖ®ÁöÑËÄÉËôë</span>
        ZygoteHooks<span class="token punctuation">.</span><span class="token function">startZygoteNoThreadCreation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Zygote goes into its own process group.</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            Os<span class="token punctuation">.</span><span class="token function">setpgid</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ErrnoException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"Failed to setpgid(0,0)"</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">final</span> Runnable caller<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
            RuntimeInit<span class="token punctuation">.</span><span class="token function">enableDdms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">boolean</span> startSystemServer <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            String socketName <span class="token operator">=</span> <span class="token string">"zygote"</span><span class="token punctuation">;</span>
            String abiList <span class="token operator">=</span> null<span class="token punctuation">;</span>
            <span class="token keyword">boolean</span> enableLazyPreload <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// Ëß£ÊûêÂèÇÊï∞ÔºåÂæóÂà∞‰∏äËø∞ÂèòÈáèÁöÑÂÄº</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> argv<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"start-system-server"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    startSystemServer <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"--enable-lazy-preload"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    enableLazyPreload <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>ABI_LIST_ARG<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    abiList <span class="token operator">=</span> argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>ABI_LIST_ARG<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>SOCKET_NAME_ARG<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    socketName <span class="token operator">=</span> argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>SOCKET_NAME_ARG<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"Unknown command line argument: "</span> <span class="token operator">+</span> argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>abiList <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"No ABI list supplied."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            zygoteServer<span class="token punctuation">.</span><span class="token function">registerServerSocket</span><span class="token punctuation">(</span>socketName<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// Ê≥®ÂÜåserver socket</span>
            <span class="token comment" spellcheck="true">// In some configurations, we avoid preloading resources and classes eagerly.</span>
            <span class="token comment" spellcheck="true">// In such cases, we will preload things prior to our first fork.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>enableLazyPreload<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
                <span class="token function">preload</span><span class="token punctuation">(</span>bootTimingsTraceLog<span class="token punctuation">)</span><span class="token punctuation">;</span>                     <span class="token comment" spellcheck="true">// ÈªòËÆ§ÊÉÖÂÜµÔºåÈ¢ÑÂä†ËΩΩ‰ø°ÊÅØ</span>
                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// Â¶ÇÊ≥®ÈáäÔºåÂª∂ËøüÈ¢ÑÂä†ËΩΩ</span>
            <span class="token comment" spellcheck="true">// ÂèòÊõ¥ZygoteËøõÁ®ã‰ºòÂÖàÁ∫ß‰∏∫NORMALÁ∫ßÂà´</span>
            <span class="token comment" spellcheck="true">// Á¨¨‰∏ÄÊ¨°forkÊó∂Êâç‰ºöpreload</span>
                Zygote<span class="token punctuation">.</span><span class="token function">resetNicePriority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment" spellcheck="true">// Do an initial gc to clean up after startup</span>
            bootTimingsTraceLog<span class="token punctuation">.</span><span class="token function">traceBegin</span><span class="token punctuation">(</span><span class="token string">"PostZygoteInitGC"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">gcAndFinalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                      <span class="token comment" spellcheck="true">// Â¶ÇÊûúÈ¢ÑÂä†ËΩΩ‰∫ÜÔºåÂæàÊúâÂøÖË¶ÅGC‰∏ÄÊ≥¢</span>
            bootTimingsTraceLog<span class="token punctuation">.</span><span class="token function">traceEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// PostZygoteInitGC</span>

            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

            <span class="token comment" spellcheck="true">// Zygote process unmounts root storage spaces.</span>
            Zygote<span class="token punctuation">.</span><span class="token function">nativeUnmountStorageOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">// Set seccomp policy</span>
            <span class="token comment" spellcheck="true">// Âä†ËΩΩseccompÁöÑËøáÊª§ËßÑÂàô</span>
            <span class="token comment" spellcheck="true">// ÊâÄÊúâ Android ËΩØ‰ª∂ÈÉΩ‰ΩøÁî®Á≥ªÁªüË∞ÉÁî®ÔºàÁÆÄÁß∞‰∏∫ syscallÔºâ‰∏é Linux ÂÜÖÊ†∏ËøõË°åÈÄö‰ø°</span>
            <span class="token comment" spellcheck="true">// ÂÜÖÊ†∏Êèê‰æõËÆ∏Â§öÁâπÂÆö‰∫éËÆæÂ§áÂíåSOCÁöÑÁ≥ªÁªüË∞ÉÁî®ÔºåËÆ©Áî®Êà∑Á©∫Èó¥ËøõÁ®ãÔºàÂåÖÊã¨Â∫îÁî®ÔºâÂèØ‰ª•Áõ¥Êé•‰∏éÂÜÖÊ†∏ËøõË°å‰∫§‰∫í</span>
            <span class="token comment" spellcheck="true">// ‰∏çËøáÔºåÂÖ∂‰∏≠ËÆ∏Â§öÁ≥ªÁªüË∞ÉÁî®AndroidÊú™‰∫à‰ΩøÁî®ÊàñÊú™‰∫àÊ≠£ÂºèÊîØÊåÅ</span>
            <span class="token comment" spellcheck="true">// ÈÄöËøáseccompÔºåAndroidÂèØ‰ΩøÂ∫îÁî®ËΩØ‰ª∂Êó†Ê≥ïËÆøÈóÆÊú™‰ΩøÁî®ÁöÑÂÜÖÊ†∏Á≥ªÁªüË∞ÉÁî®</span>
            <span class="token comment" spellcheck="true">// Áî±‰∫éÂ∫îÁî®Êó†Ê≥ïËÆøÈóÆËøô‰∫õÁ≥ªÁªüË∞ÉÁî®ÔºåÂõ†Ê≠§ÔºåÂÆÉ‰ª¨‰∏ç‰ºöË¢´ÊΩúÂú®ÁöÑÊúâÂÆ≥Â∫îÁî®Âà©Áî®</span>
            <span class="token comment" spellcheck="true">// ËØ•ËøáÊª§Âô®ÂÆâË£ÖÂà∞zygoteËøõÁ®ã‰∏≠ÔºåÁî±‰∫éÊâÄÊúâAndroidÂ∫îÁî®ÂùáË°çÁîüËá™ËØ•ËøõÁ®ã</span>
            <span class="token comment" spellcheck="true">// Âõ†ËÄå‰ºöÂΩ±ÂìçÂà∞ÊâÄÊúâÂ∫îÁî®</span>
            Seccomp<span class="token punctuation">.</span><span class="token function">setPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">/// M: Added for BOOTPROF</span>
            <span class="token function">addBootEvent</span><span class="token punctuation">(</span><span class="token string">"Zygote:Preload End"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">/// @}</span>
            ZygoteHooks<span class="token punctuation">.</span><span class="token function">stopZygoteNoThreadCreation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment" spellcheck="true">// ÂÖÅËÆ∏ÊúâÂÖ∂ÂÆÉÁ∫øÁ®ã‰∫Ü</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>startSystemServer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                Runnable r <span class="token operator">=</span> <span class="token function">forkSystemServer</span><span class="token punctuation">(</span>abiList<span class="token punctuation">,</span> socketName<span class="token punctuation">,</span> zygoteServer<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// forkÂá∫system server</span>

                <span class="token comment" spellcheck="true">// {@code r == null} in the parent (zygote) process, and {@code r != null} in the</span>
                <span class="token comment" spellcheck="true">// child (system_server) process.</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    r<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            Log<span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"Accepting command socket connections"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">// The select loop returns early in the child process after a fork and</span>
            <span class="token comment" spellcheck="true">// loops forever in the zygote.</span>
            caller <span class="token operator">=</span> zygoteServer<span class="token punctuation">.</span><span class="token function">runSelectLoop</span><span class="token punctuation">(</span>abiList<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">// zygoteËøõÁ®ãËøõÂÖ•Êó†ÈôêÂæ™ÁéØÔºåÂ§ÑÁêÜËØ∑Ê±Ç</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            zygoteServer<span class="token punctuation">.</span><span class="token function">closeServerSocket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// We're in the child process and have exited the select loop. Proceed to execute the</span>
        <span class="token comment" spellcheck="true">// command.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>caller <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            caller<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre>
<p>‰∏äÈù¢ÊòØZygoteInitÁöÑmainÂáΩÊï∞ÁöÑ‰∏ªÂπ≤ÈÉ®ÂàÜÔºåÈô§‰∫ÜÂÆâÂÖ®Áõ∏ÂÖ≥ÁöÑÂÜÖÂÆπÂ§ñÔºåÊúÄ‰∏ªË¶ÅÁöÑÂ∑•‰ΩúÂ∞±ÊòØÊ≥®ÂÜåserver socket„ÄÅÈ¢ÑÂä†ËΩΩ„ÄÅÂêØÂä®system serverÂèäËøõÂÖ•Êó†ÈôêÂæ™ÁéØÂ§ÑÁêÜËØ∑Ê±ÇÊ∂àÊÅØ„ÄÇ </p>
<p>Êé•‰∏ãÊù•Êàë‰ª¨ÂàÜÂõõÈÉ®ÂàÜÂàÜÂà´ËÆ®ËÆ∫ÔºÅ</p>
<h3 id="ÂàõÂª∫server-socket"><a href="#ÂàõÂª∫server-socket" class="headerlink" title="ÂàõÂª∫server socket"></a>ÂàõÂª∫server socket</h3><p>Android OÂ∞Üserver socketÁõ∏ÂÖ≥ÁöÑÂ∑•‰ΩúÊäΩË±°Âà∞ZygoteServer.java‰∏≠‰∫Ü„ÄÇÊàë‰ª¨Êù•ÁúãÁúãÂÖ∂‰∏≠ÁöÑregisterZygoteSocketÂáΩÊï∞Ôºö</p>
<pre class=" language-C++"><code class="language-C++">    /**
     * Registers a server socket for zygote command connections
     *
     * @throws RuntimeException when open fails
     */
    void registerServerSocket(String socketName) {
        if (mServerSocket == null) {
            int fileDesc;
            // ANDROID_SOCKET_PREFIX‰∏∫"ANDROID_SOCKET_"
            // Ê≠§Â§ÑÁöÑsocket nameÔºåÂ∞±ÊòØzygote
            final String fullSocketName = ANDROID_SOCKET_PREFIX + socketName;
            try {
                // ËøòËÆ∞Âæó‰πàÔºüÂú®init.zygote.rcË¢´Âä†ËΩΩÊó∂ÔºåÊåáÂÆö‰∫ÜÂêç‰∏∫zygoteÁöÑsocket
                // Âú®ËøõÁ®ãË¢´ÂàõÂª∫Êó∂ÔºåÂ∞±‰ºöÂàõÂª∫ÂØπÂ∫îÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶ÔºåÂπ∂Âä†ÂÖ•Âà∞ÁéØÂ¢ÉÂèòÈáè‰∏≠
                // Âõ†Ê≠§ÔºåÊ≠§Êó∂ÂèØ‰ª•ÂèñÂá∫ÂØπÂ∫îÁöÑÁéØÂ¢ÉÂèòÈáè
                String env = System.getenv(fullSocketName);
                fileDesc = Integer.parseInt(env);
            } catch (RuntimeException ex) {
                throw new RuntimeException(fullSocketName + " unset or invalid", ex);
            }

            try {
                FileDescriptor fd = new FileDescriptor();
                fd.setInt$(fileDesc);                           // Ëé∑Âèñzygote socketÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶
                mServerSocket = new LocalServerSocket(fd);      // Â∞ÜsocketÂåÖË£ÖÊàê‰∏Ä‰∏™server socket
            } catch (IOException ex) {
                throw new RuntimeException(
                        "Error binding to local socket '" + fileDesc + "'", ex);
            }
        }
    }
</code></pre>
<p>Êàë‰ª¨Ë∑üË∏™LocalServerSocket()Ôºö</p>
<pre class=" language-java"><code class="language-java">    <span class="token keyword">public</span> <span class="token function">LocalServerSocket</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException
    <span class="token punctuation">{</span>
        impl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LocalSocketImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        impl<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>LocalSocket<span class="token punctuation">.</span>SOCKET_STREAM<span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment" spellcheck="true">// ÂàõÂª∫SOCKET_STREAMÁ±ªÂûãÁöÑAF_UNIX socket</span>

        localAddress <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LocalSocketAddress</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        impl<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>localAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token comment" spellcheck="true">// ÁªëÂÆöÂà∞ÊåáÂÆöÂú∞ÂùÄ</span>

        impl<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>LISTEN_BACKLOG<span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token comment" spellcheck="true">// ÂºÄÂßãÁõëÂê¨</span>
    <span class="token punctuation">}</span>
</code></pre>
<h3 id="È¢ÑÂä†ËΩΩ"><a href="#È¢ÑÂä†ËΩΩ" class="headerlink" title="È¢ÑÂä†ËΩΩ"></a>È¢ÑÂä†ËΩΩ</h3><p>Êàë‰ª¨ÁúãÁúãÈ¢ÑÂä†ËΩΩÁöÑÂÜÖÂÆπÔºö</p>
<pre class=" language-java"><code class="language-java">    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">preload</span><span class="token punctuation">(</span>TimingsTraceLog bootTimingsTraceLog<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

        <span class="token function">beginIcuCachePinning</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                       <span class="token comment" spellcheck="true">// Pin ICU Data, Ëé∑ÂèñÂ≠óÁ¨¶ÈõÜËΩ¨Êç¢ËµÑÊ∫êÁ≠â</span>

        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    

        <span class="token function">preloadClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                             <span class="token comment" spellcheck="true">// ËØªÂèñÊñá‰ª∂system/etc/preloaded-classesÔºåÁÑ∂ÂêéÈÄöËøáÂèçÂ∞ÑÂä†ËΩΩÂØπÂ∫îÁöÑÁ±ª</span>
                                                                      <span class="token comment" spellcheck="true">// ‰∏ÄËà¨Áî±ÂéÇÂïÜÊù•ÂÆö‰πâÔºåÊúâÊó∂ÈúÄË¶ÅÂä†ËΩΩÊï∞ÂçÉ‰∏™Á±ªÔºåÂêØÂä®ÊÖ¢ÁöÑÂéüÂõ†‰πã‰∏Ä</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

        <span class="token function">preloadResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                           <span class="token comment" spellcheck="true">// Ë¥üË¥£Âä†ËΩΩ‰∏Ä‰∫õÂ∏∏Áî®ÁöÑÁ≥ªÁªüËµÑÊ∫ê</span>

        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token function">nativePreloadAppProcessHALs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

        <span class="token function">preloadOpenGL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                              <span class="token comment" spellcheck="true">// ÂõæÂΩ¢Áõ∏ÂÖ≥</span>

        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

        <span class="token function">preloadSharedLibraries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                     <span class="token comment" spellcheck="true">// ‰∏Ä‰∫õÂøÖË¶ÅÂ∫ì</span>
        <span class="token function">preloadTextResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                       <span class="token comment" spellcheck="true">// ËØ≠Ë®ÄÁõ∏ÂÖ≥ÁöÑÂ≠óÁ¨¶‰ø°ÊÅØ</span>
        <span class="token comment" spellcheck="true">// Ask the WebViewFactory to do any initialization that must run in the zygote process,</span>
        <span class="token comment" spellcheck="true">// for memory sharing purposes.</span>
        WebViewFactory<span class="token punctuation">.</span><span class="token function">prepareWebViewInZygote</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">endIcuCachePinning</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">warmUpJcaProviders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                         <span class="token comment" spellcheck="true">// ÂÆâÂÖ®Áõ∏ÂÖ≥ÁöÑ</span>
        Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"end preload"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        sPreloadComplete <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
<p>‰∏∫‰∫ÜËÆ©Á≥ªÁªüÂÆûÈôÖËøêË°åÊó∂Êõ¥Âä†ÊµÅÁïÖÔºåÂú®zygoteÂêØÂä®Êó∂ÂÄôÔºåË∞ÉÁî®preloadÂáΩÊï∞ËøõË°å‰∫Ü‰∏Ä‰∫õÈ¢ÑÂä†ËΩΩÊìç‰Ωú„ÄÇAndroid ÈÄöËøázygote forkÁöÑÊñπÂºèÂàõÂª∫Â≠êËøõÁ®ã„ÄÇzygoteËøõÁ®ãÈ¢ÑÂä†ËΩΩËøô‰∫õÁ±ªÂíåËµÑÊ∫êÔºåÂú®forkÂ≠êËøõÁ®ãÊó∂Ôºå‰ªÖÈúÄË¶ÅÂÅö‰∏Ä‰∏™Â§çÂà∂Âç≥ÂèØ„ÄÇ<br>ËøôÊ†∑ÂèØ‰ª•ËäÇÁ∫¶Â≠êËøõÁ®ãÁöÑÂêØÂä®Êó∂Èó¥„ÄÇÂêåÊó∂ÔºåÊ†πÊçÆforkÁöÑcopy-on-writeÊú∫Âà∂ÂèØÁü•ÔºåÊúâ‰∫õÁ±ªÂ¶ÇÊûú‰∏çÂÅöÊîπÂèòÔºåÁîöËá≥ÈÉΩ‰∏çÁî®Â§çÂà∂ÔºåÂ≠êËøõÁ®ãÂèØ‰ª•ÂíåÁà∂ËøõÁ®ãÂÖ±‰∫´ËøôÈÉ®ÂàÜÊï∞ÊçÆÔºå‰ªéËÄåÁúÅÂéª‰∏çÂ∞ëÂÜÖÂ≠òÁöÑÂç†Áî®„ÄÇ</p>
<h3 id="ÂêØÂä®SystemServerËøõÁ®ã"><a href="#ÂêØÂä®SystemServerËøõÁ®ã" class="headerlink" title="ÂêØÂä®SystemServerËøõÁ®ã"></a>ÂêØÂä®SystemServerËøõÁ®ã</h3><p>ÂÜçÊù•ÁúãÁúãÂêØÂä®System ServerÁöÑÊµÅÁ®ãÔºö</p>
<pre class=" language-java"><code class="language-java">    <span class="token comment" spellcheck="true">/**
     * Prepare the arguments and forks for the system server process.
     *
     * Returns an {@code Runnable} that provides an entrypoint into system_server code in the
     * child process, and {@code null} in the parent.
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> Runnable <span class="token function">forkSystemServer</span><span class="token punctuation">(</span>String abiList<span class="token punctuation">,</span> String socketName<span class="token punctuation">,</span>
            ZygoteServer zygoteServer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> capabilities <span class="token operator">=</span> <span class="token function">posixCapabilitiesAsBits</span><span class="token punctuation">(</span>
            OsConstants<span class="token punctuation">.</span>CAP_IPC_LOCK<span class="token punctuation">,</span>
            OsConstants<span class="token punctuation">.</span>CAP_KILL<span class="token punctuation">,</span>
            OsConstants<span class="token punctuation">.</span>CAP_NET_ADMIN<span class="token punctuation">,</span>
            OsConstants<span class="token punctuation">.</span>CAP_NET_BIND_SERVICE<span class="token punctuation">,</span>
            OsConstants<span class="token punctuation">.</span>CAP_NET_BROADCAST<span class="token punctuation">,</span>
            OsConstants<span class="token punctuation">.</span>CAP_NET_RAW<span class="token punctuation">,</span>
            OsConstants<span class="token punctuation">.</span>CAP_SYS_MODULE<span class="token punctuation">,</span>
            OsConstants<span class="token punctuation">.</span>CAP_SYS_NICE<span class="token punctuation">,</span>
            OsConstants<span class="token punctuation">.</span>CAP_SYS_PTRACE<span class="token punctuation">,</span>
            OsConstants<span class="token punctuation">.</span>CAP_SYS_TIME<span class="token punctuation">,</span>
            OsConstants<span class="token punctuation">.</span>CAP_SYS_TTY_CONFIG<span class="token punctuation">,</span>
            OsConstants<span class="token punctuation">.</span>CAP_WAKE_ALARM
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">/* Containers run without this capability, so avoid setting it in that case */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>SystemProperties<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span>PROPERTY_RUNNING_IN_CONTAINER<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            capabilities <span class="token operator">|=</span> <span class="token function">posixCapabilitiesAsBits</span><span class="token punctuation">(</span>OsConstants<span class="token punctuation">.</span>CAP_BLOCK_SUSPEND<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">/* Hardcoded command line to start the system server */</span>
        String args<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">"--setuid=1000"</span><span class="token punctuation">,</span>
            <span class="token string">"--setgid=1000"</span><span class="token punctuation">,</span>
            <span class="token string">"--setgroups=1001,1002,1003,1004,1005,1006,1007,1008,1009,1010,1018,1021,1023,1032,3001,3002,3003,3006,3007,3009,3010"</span><span class="token punctuation">,</span>
            <span class="token string">"--capabilities="</span> <span class="token operator">+</span> capabilities <span class="token operator">+</span> <span class="token string">","</span> <span class="token operator">+</span> capabilities<span class="token punctuation">,</span>
            <span class="token string">"--nice-name=system_server"</span><span class="token punctuation">,</span>
            <span class="token string">"--runtime-args"</span><span class="token punctuation">,</span>
            <span class="token string">"com.android.server.SystemServer"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        ZygoteConnection<span class="token punctuation">.</span>Arguments parsedArgs <span class="token operator">=</span> null<span class="token punctuation">;</span>

        <span class="token keyword">int</span> pid<span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            parsedArgs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZygoteConnection<span class="token punctuation">.</span>Arguments</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// Â∞Ü‰∏äÈù¢ÂáÜÂ§áÁöÑÂèÇÊï∞ÔºåÊåâÁÖßZygoteConnectionÁöÑÈ£éÊ†ºËøõË°åÂ∞ÅË£Ö</span>
            ZygoteConnection<span class="token punctuation">.</span><span class="token function">applyDebuggerSystemProperty</span><span class="token punctuation">(</span>parsedArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ZygoteConnection<span class="token punctuation">.</span><span class="token function">applyInvokeWithSystemProperty</span><span class="token punctuation">(</span>parsedArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">/* Request to fork the system server process */</span>
            pid <span class="token operator">=</span> Zygote<span class="token punctuation">.</span><span class="token function">forkSystemServer</span><span class="token punctuation">(</span>                                <span class="token comment" spellcheck="true">// ÈÄöËøáfork"ÂàÜË£Ç"Âá∫system_server</span>
                    parsedArgs<span class="token punctuation">.</span>uid<span class="token punctuation">,</span> parsedArgs<span class="token punctuation">.</span>gid<span class="token punctuation">,</span>
                    parsedArgs<span class="token punctuation">.</span>gids<span class="token punctuation">,</span>
                    parsedArgs<span class="token punctuation">.</span>debugFlags<span class="token punctuation">,</span>
                    null<span class="token punctuation">,</span>
                    parsedArgs<span class="token punctuation">.</span>permittedCapabilities<span class="token punctuation">,</span>
                    parsedArgs<span class="token punctuation">.</span>effectiveCapabilities<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalArgumentException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">/* For child process */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// Â§ÑÁêÜ32_64Âíå64_32ÁöÑÊÉÖÂÜµ</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasSecondZygote</span><span class="token punctuation">(</span>abiList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">waitForSecondaryZygote</span><span class="token punctuation">(</span>socketName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment" spellcheck="true">// forkÊó∂‰ºöcopy socketÔºåsystem serverÈúÄË¶Å‰∏ªÂä®ÂÖ≥Èó≠</span>
            zygoteServer<span class="token punctuation">.</span><span class="token function">closeServerSocket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// system serverËøõÁ®ãÂ§ÑÁêÜËá™Â∑±ÁöÑÂ∑•‰Ωú</span>
            <span class="token keyword">return</span> <span class="token function">handleSystemServerProcess</span><span class="token punctuation">(</span>parsedArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> null<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
<h3 id="Â§ÑÁêÜËØ∑Ê±Ç‰ø°ÊÅØ"><a href="#Â§ÑÁêÜËØ∑Ê±Ç‰ø°ÊÅØ" class="headerlink" title="Â§ÑÁêÜËØ∑Ê±Ç‰ø°ÊÅØ"></a>Â§ÑÁêÜËØ∑Ê±Ç‰ø°ÊÅØ</h3><p>ÂàõÂª∫Âá∫SystemServerËøõÁ®ãÂêéÔºåzygoteËøõÁ®ãË∞ÉÁî®ZygoteServer‰∏≠ÁöÑÂáΩÊï∞runSelectLoopÔºåÂ§ÑÁêÜserver socketÊî∂Âà∞ÁöÑÂëΩ‰ª§„ÄÇ</p>
<pre class=" language-java"><code class="language-java">    <span class="token comment" spellcheck="true">/**
     * Runs the zygote process's select loop. Accepts new connections as
     * they happen, and reads commands from connections one spawn-request's
     * worth at a time.
     */</span>
    Runnable <span class="token function">runSelectLoop</span><span class="token punctuation">(</span>String abiList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ArrayList<span class="token operator">&lt;</span>FileDescriptor<span class="token operator">></span> fds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span>FileDescriptor<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ArrayList<span class="token operator">&lt;</span>ZygoteConnection<span class="token operator">></span> peers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span>ZygoteConnection<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// È¶ñÂÖàÂ∞Üserver socketÂä†ÂÖ•Âà∞fds</span>
        fds<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>mServerSocket<span class="token punctuation">.</span><span class="token function">getFileDescriptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        peers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// ÊØèÊ¨°Âæ™ÁéØÔºåÈÉΩÈáçÊñ∞ÂàõÂª∫ÈúÄË¶ÅÁõëÂê¨ÁöÑpollFds</span>
            StructPollfd<span class="token punctuation">[</span><span class="token punctuation">]</span> pollFds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StructPollfd</span><span class="token punctuation">[</span>fds<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> pollFds<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                pollFds<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StructPollfd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                pollFds<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>fd <span class="token operator">=</span> fds<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment" spellcheck="true">// ÂÖ≥Ê≥®‰∫ã‰ª∂Âà∞Êù•</span>
                pollFds<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>events <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span> POLLIN<span class="token punctuation">;</span>                
            <span class="token punctuation">}</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// Á≠âÂæÖ‰∫ã‰ª∂Âà∞Êù•</span>
                Os<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span>pollFds<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ErrnoException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"poll failed"</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment" spellcheck="true">// Ê≥®ÊÑèËøôÈáåÊòØÂÄíÂ∫èÁöÑÔºåÂç≥‰ºòÂÖàÂ§ÑÁêÜÂ∑≤Âª∫Á´ãÈìæÊé•ÁöÑ‰ø°ÊÅØÔºåÂêéÂ§ÑÁêÜÊñ∞Âª∫ÈìæÊé•ÁöÑËØ∑Ê±Ç</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> pollFds<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token operator">--</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pollFds<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>revents <span class="token operator">&amp;</span> POLLIN<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">continue</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token comment" spellcheck="true">// server socketÊúÄÂÖàÂä†ÂÖ•fdsÔºå Âõ†Ê≠§ËøôÈáåÊòØserver socketÊî∂Âà∞Êï∞ÊçÆ</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment" spellcheck="true">// Êî∂Âà∞Êñ∞ÁöÑÂª∫Á´ãÈÄö‰ø°ÁöÑËØ∑Ê±ÇÔºåÂª∫Á´ãÈÄö‰ø°ËøûÊé•</span>
                    ZygoteConnection newPeer <span class="token operator">=</span> <span class="token function">acceptCommandPeer</span><span class="token punctuation">(</span>abiList<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment" spellcheck="true">// Âä†ÂÖ•Âà∞peersÂíåfds, Âç≥‰∏ã‰∏ÄÊ¨°‰πüÂºÄÂßãÁõëÂê¨</span>
                    peers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>newPeer<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    fds<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>newPeer<span class="token punctuation">.</span><span class="token function">getFileDesciptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token comment" spellcheck="true">//ÂÖ∂ÂÆÉÈÄö‰ø°ËøûÊé•Êî∂Âà∞Êï∞ÊçÆ</span>
                    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre>
<p>‰ªé‰∏äÈù¢‰ª£Á†ÅÂèØÁü•ÔºåÂàùÂßãÊó∂fds‰∏≠‰ªÖÊúâserver socketÔºåÂõ†Ê≠§ÂΩìÊúâÊï∞ÊçÆÂà∞Êù•Êó∂ÔºåÂ∞ÜÊâßË°åiÁ≠â‰∫é0ÁöÑÂàÜÊîØ„ÄÇÊ≠§Êó∂ÔºåÊòæÁÑ∂ÊòØÈúÄË¶ÅÂàõÂª∫Êñ∞ÁöÑÈÄö‰ø°ËøûÊé•ÔºåÂõ†Ê≠§acceptCommandPeerÂ∞ÜË¢´Ë∞ÉÁî®„ÄÇ</p>
<p>Êàë‰ª¨ÁúãÁúãacceptCommandPeerÂáΩÊï∞Ôºö</p>
<pre class=" language-java"><code class="language-java">    <span class="token comment" spellcheck="true">/**
     * Waits for and accepts a single command connection. Throws
     * RuntimeException on failure.
     */</span>
    <span class="token keyword">private</span> ZygoteConnection <span class="token function">acceptCommandPeer</span><span class="token punctuation">(</span>String abiList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// socketÁºñÁ®ã‰∏≠Ôºåaccept()Ë∞ÉÁî®‰∏ªË¶ÅÁî®Âú®Âü∫‰∫éËøûÊé•ÁöÑÂ•óÊé•Â≠óÁ±ªÂûãÔºåÊØîÂ¶ÇSOCK_STREAMÂíåSOCK_SEQPACKET</span>
            <span class="token comment" spellcheck="true">// ÂÆÉÊèêÂèñÂá∫ÊâÄÁõëÂê¨Â•óÊé•Â≠óÁöÑÁ≠âÂæÖËøûÊé•ÈòüÂàó‰∏≠Á¨¨‰∏Ä‰∏™ËøûÊé•ËØ∑Ê±ÇÔºåÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑÂ•óÊé•Â≠óÔºåÂπ∂ËøîÂõûÊåáÂêëËØ•Â•óÊé•Â≠óÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶</span>
            <span class="token comment" spellcheck="true">// Êñ∞Âª∫Á´ãÁöÑÂ•óÊé•Â≠ó‰∏çÂú®ÁõëÂê¨Áä∂ÊÄÅÔºåÂéüÊù•ÊâÄÁõëÂê¨ÁöÑÂ•óÊé•Â≠óÁöÑÁä∂ÊÄÅ‰πü‰∏çÂèóaccept()Ë∞ÉÁî®ÁöÑÂΩ±Âìç</span>
            <span class="token keyword">return</span> <span class="token function">createNewConnection</span><span class="token punctuation">(</span>mServerSocket<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> abiList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>
                    <span class="token string">"IOException during accept()"</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> ZygoteConnection <span class="token function">createNewConnection</span><span class="token punctuation">(</span>LocalSocket socket<span class="token punctuation">,</span> String abiList<span class="token punctuation">)</span>
            <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ZygoteConnection</span><span class="token punctuation">(</span>socket<span class="token punctuation">,</span> abiList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
<p>‰ªé‰∏äÈù¢ÁöÑ‰ª£Á†ÅÔºåÂèØ‰ª•ÁúãÂá∫acceptCommandPeerË∞ÉÁî®‰∫Üserver socketÁöÑaccpetÂáΩÊï∞„ÄÇ‰∫éÊòØÂΩìÊñ∞ÁöÑËøûÊé•Âª∫Á´ãÊó∂ÔºåzygoteÂ∞Ü‰ºöÂàõÂª∫Âá∫‰∏Ä‰∏™Êñ∞ÁöÑsocket‰∏éÂÖ∂ÈÄö‰ø°ÔºåÂπ∂Â∞ÜËØ•socketÂä†ÂÖ•Âà∞fds‰∏≠„ÄÇÂõ†Ê≠§Ôºå‰∏ÄÊó¶ÈÄö‰ø°ËøûÊé•Âª∫Á´ãÂêéÔºåfds‰∏≠Â∞Ü‰ºöÂåÖÂê´ÊúâÂ§ö‰∏™socket„ÄÇ</p>
<p>ÂΩìpollÁõëÂê¨Âà∞Ëøô‰∏ÄÁªÑsockets‰∏äÊúâÊï∞ÊçÆÂà∞Êù•Êó∂ÔºåÂ∞±‰ºö‰ªéÈòªÂ°û‰∏≠ÊÅ¢Â§ç„ÄÇ‰∫éÊòØÔºåÊàë‰ª¨ÈúÄË¶ÅÂà§Êñ≠Âà∞Â∫ïÊòØÂì™‰∏™socketÊî∂Âà∞‰∫ÜÊï∞ÊçÆ„ÄÇ</p>
<p>Âú®runSelectLoop‰∏≠ÈááÁî®ÂÄíÂ∫èÁöÑÊñπÂºèËΩÆËØ¢„ÄÇÁî±‰∫éserver socketÁ¨¨‰∏Ä‰∏™Ë¢´Âä†ÂÖ•Âà∞fdsÔºåÂõ†Ê≠§ÊúÄÂêéËΩÆËØ¢Âà∞ÁöÑsocketÊâçÈúÄË¶ÅÂ§ÑÁêÜÊñ∞Âª∫ËøûÊé•ÁöÑÊìç‰ΩúÔºõÂÖ∂ÂÆÉsocketÊî∂Âà∞Êï∞ÊçÆÊó∂Ôºå‰ªÖÈúÄË¶ÅË∞ÉÁî®zygoteConnectionÁöÑrunonceÂáΩÊï∞ÊâßË°åÊï∞ÊçÆÂØπÂ∫îÁöÑÊìç‰Ωú„ÄÇËã•‰∏Ä‰∏™ËøûÊé•Â§ÑÁêÜÂÆåÊâÄÊúâÂØπÂ∫îÊ∂àÊÅØÂêéÔºåËØ•ËøûÊé•ÂØπÂ∫îÁöÑsocketÂíåËøûÊé•Á≠âÂ∞ÜË¢´ÁßªÈô§„ÄÇ</p>
<h1 id="ÂÆåÁªì"><a href="#ÂÆåÁªì" class="headerlink" title="ÂÆåÁªì"></a>ÂÆåÁªì</h1><p><center><strong><font color="#87CEFA" size="4">ZygoteÂêØÂä®ÊµÅÁ®ãÂà∞Ê≠§ÁªìÊùüÔºåZygoteËøõÁ®ãÂÖ±ÂÅö‰∫ÜÂ¶Ç‰∏ãÂá†‰ª∂‰∫ã</font></strong></center><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;üî® 1. ÂàõÂª∫AppRuntimeÂπ∂Ë∞ÉÁî®ÂÖ∂startÊñπÊ≥ïÔºåÂêØÂä®ZygoteËøõÁ®ã„ÄÇ<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;üî® 2. ÂàõÂª∫JavaVMÂπ∂‰∏∫JavaVMÊ≥®ÂÜåJNI.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;üî® 3. ÈÄöËøáJNIË∞ÉÁî®ZygoteInitÁöÑmainÂáΩÊï∞ËøõÂÖ•ZygoteÁöÑJavaÊ°ÜÊû∂Â±Ç„ÄÇ<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;üî® 4. ÈÄöËøáregisterZygoteSocketÂáΩÊï∞ÂàõÂª∫ÊúçÂä°Á´ØSocketÔºåÈ¢ÑÂä†ËΩΩÁ±ªÂíåËµÑÊ∫êÔºåÂπ∂ÈÄöËøárunSelectLoopÂáΩÊï∞Á≠âÂæÖÂ¶ÇActivityManagerServiceÁ≠âÁöÑËØ∑Ê±Ç„ÄÇ<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;üî® 5. ÂêØÂä®SystemServerËøõÁ®ã„ÄÇ</p>
<h1 id="ÂèÇËÄÉBlog"><a href="#ÂèÇËÄÉBlog" class="headerlink" title="ÂèÇËÄÉBlog"></a>ÂèÇËÄÉBlog</h1><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 01. <a href="https://blog.csdn.net/tfygg/article/details/52086621" target="_blank" rel="noopener">https://blog.csdn.net/tfygg/article/details/52086621</a><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 02. <a href="https://www.jianshu.com/p/cbc6b84aee08" target="_blank" rel="noopener">https://www.jianshu.com/p/cbc6b84aee08</a><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 03. <a href="https://www.jianshu.com/p/ab9b83a77af6" target="_blank" rel="noopener">https://www.jianshu.com/p/ab9b83a77af6</a></p>

            </div>
            <hr>

            

            <!--<link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone" data-wechat-qrcode-helper="<p>ÂæÆ‰ø°ÈáåÁÇπ‚ÄúÂèëÁé∞‚Äù->‚ÄúÊâ´‰∏ÄÊâ´‚Äù‰∫åÁª¥Á†Å‰æøÂèØÊü•ÁúãÂàÜ‰∫´„ÄÇ</p>"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>-->

            <div class="reprint">
                <p>
                    <span class="reprint-tip">
                        <i class="fa fa-exclamation-circle"></i>&nbsp;&nbsp;ËΩ¨ËΩΩËØ∑Ê≥®Êòé:
                    </span>
                    <a href="https://superandroid.pro" class="b-link-green">Thinking in Android</a>
                    <i class="fa fa-angle-right fa-lg fa-fw text-color"></i>
                    <a href="/2018/12/10/01.xi-tong-qi-dong-jie-duan-android-xi-tong-qi-dong-pian-shen-ru-zuan-yan-android-qi-dong-jie-duan-zhi-zygote/" class="b-link-green">Ê∑±ÂÖ•ÈíªÁ†î Android ÂêØÂä®Èò∂ÊÆµ ‰πã zygote</a>
                </p>
            </div>
        </div>
    </div>

    

    

    

    

    

    <!--

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6 overflow-policy" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fa fa-chevron-left"></i>&nbsp;‰∏ä‰∏ÄÁØá</div>
            <div class="card">
                <a href="/2018/12/18/01.xi-tong-qi-dong-jie-duan-android-xi-tong-qi-dong-pian-shen-ru-zuan-yan-android-qi-dong-jie-duan-zhi-systemserver/">
                    <div class="card-image">
                        
                        <img src="/medias/featureimages/Á≥ªÁªüÂêØÂä®-02.jpg" class="responsive-img" alt="Ê∑±ÂÖ•ÈíªÁ†î Android ÂêØÂä®Èò∂ÊÆµ ‰πã systemserver">
                        
                        <span class="card-title">Ê∑±ÂÖ•ÈíªÁ†î Android ÂêØÂä®Èò∂ÊÆµ ‰πã systemserver</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄ üçÄAndroid ÂêØÂä®Èò∂ÊÆµÁ≥ªÂàóüçÄ üçÄ üçÄ üçÄ üçÄ üçÄ ÔøΩ</div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="fa fa-clock-o fa-fw icon-date"></i>2018-12-18
                        </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Á≥ªÁªüÂêØÂä®/" class="post-category" target="_blank">
                                    Á≥ªÁªüÂêØÂä®
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/ÂêØÂä®Èò∂ÊÆµ/" target="_blank">
                        <span class="chip bg-color">ÂêØÂä®Èò∂ÊÆµ</span>
                    </a>
                    
                    <a href="/tags/SystemServer/" target="_blank">
                        <span class="chip bg-color">SystemServer</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6 overflow-policy" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                ‰∏ã‰∏ÄÁØá&nbsp;<i class="fa fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2018/12/01/01.xi-tong-qi-dong-jie-duan-android-xi-tong-qi-dong-pian-shen-ru-zuan-yan-android-qi-dong-jie-duan-zhi-init/">
                    <div class="card-image">
                        
                        <img src="/medias/featureimages/Á≥ªÁªüÂêØÂä®-02.jpg" class="responsive-img" alt="Ê∑±ÂÖ•ÈíªÁ†î Android ÂêØÂä®Èò∂ÊÆµ ‰πã init">
                        
                        <span class="card-title">Ê∑±ÂÖ•ÈíªÁ†î Android ÂêØÂä®Èò∂ÊÆµ ‰πã init</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè‚ÄúAndroid ÂêØÂä®Èò∂ÊÆµ‚ÄùÁ≥ªÂàóÊñáÁ´†‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè ‚úè </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2018-12-01
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Á≥ªÁªüÂêØÂä®/" class="post-category" target="_blank">
                                    Á≥ªÁªüÂêØÂä®
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/ÂêØÂä®Èò∂ÊÆµ/" target="_blank">
                        <span class="chip bg-color">ÂêØÂä®Èò∂ÊÆµ</span>
                    </a>
                    
                    <a href="/tags/init/" target="_blank">
                        <span class="chip bg-color">init</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>-->
</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + 'Êù•Ê∫ê: Thinking in Android<br />'
            + '‰ΩúËÄÖ: Marco<br />'
            + 'ÈìæÊé•: <a href="' + url + '">' + url + '</a><br />'
            + 'Êú¨ÊñáÁ´†Ëëó‰ΩúÊùÉÂΩí‰ΩúËÄÖÊâÄÊúâÔºå‰ªª‰ΩïÂΩ¢ÂºèÁöÑËΩ¨ËΩΩÈÉΩËØ∑Ê≥®ÊòéÂá∫Â§Ñ„ÄÇ';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>

    

</main>


<footer class="page-footer bg-color-foot-marco">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
		    &copy; 2018 - 2019&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;In-depth analysis of Android system source code &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-graduation-cap" aria-hidden="true"></i>&nbsp;&nbsp;Marco<br>
            
			
                
                <span id="busuanzi_container_site_pv">
                    Total visits to this site: <span id="busuanzi_value_site_pv"></span> ,&nbsp;
                </span>
				<span id="busuanzi_container_site_uv">
                    Total visitor: <span id="busuanzi_value_site_uv"></span> .
                </span>
			
		</div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/pepsimaxin/pepsimaxin.github.io" class="tooltipped" target="_blank" data-tooltip="ËÆøÈóÆÊàëÁöÑGitHub" data-position="top" data-delay="50">
        <i class="fa fa-github"></i>
    </a>



    <a href="mailto:pepsimaxin@163.com" class="tooltipped" target="_blank" data-tooltip="ÈÇÆ‰ª∂ËÅîÁ≥ªÊàë" data-position="top" data-delay="50">
        <i class="fa fa-envelope"></i>
    </a>



    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=516749232" class="tooltipped" data-tooltip="QQËÅîÁ≥ªÊàë: 516749232" data-position="top" data-delay="50">
        <i class="fa fa-qq"></i>
    </a>


<!--
    <a href="https://blog.csdn.net/pepsimaxin" class="tooltipped" data-tooltip="ËÆøÈóÆÊàëÁöÑCSDN" data-position="top" data-delay="50">
        <i class="fa fa-chain-broken"></i>
    </a>
-->


    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS ËÆ¢ÈòÖ" data-position="top" data-delay="50">
        <i class="fa fa-rss"></i>
    </a>
</div>
    </div>
</footer>

<!--<div class="progress-bar"></div>-->

<!-- ÊêúÁ¥¢ÈÅÆÁΩ©Ê°Ü -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fa fa-search"></i>&nbsp;&nbsp;Ê£ÄÁ¥¢ÂçöÊñá</span>
            <input type="search" id="searchInput" name="s" placeholder="ËØ∑ËæìÂÖ•ÊêúÁ¥¢ÁöÑÊäÄÊúØÂÖ≥ÈîÆÂ≠ó" class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
<!-- ÂõûÂà∞È°∂ÈÉ®ÊåâÈíÆ -->
<!--<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>-->


<script src="/libs/materialize/materialize.min.js"></script>
<script src="/libs/masonry/masonry.pkgd.min.js"></script>
<script src="/libs/aos/aos.js"></script>
<script src="/libs/scrollprogress/scrollProgress.min.js"></script>
<script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
<script src="/js/matery.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->




    <script async src="/libs/others/busuanzi.pure.mini.js"></script>


</body>
</html>